<!-- 
  -- This file was generated by StateSmith.
  -- Note! The generated state machine code in this file has been specially instrumented to support simulator features.
  -- Regular generated javascript state machine code is smaller and simpler.
  -->
<html>
  <head>
    <link rel='icon' type='image/png' href='https://statesmith.github.io/favicon.png'>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined'>
    <style>
      body {
        display: flex;
        flex-direction: row;
        margin: 0px;
      }

      /* Fix for mermaid content requiring scroll bars https://github.com/StateSmith/StateSmith/issues/288 */
      pre.mermaid {
        margin: 0px;
      }

      .wrapper {
        height: 100vh;
        width: 100vw;
        display: flex;
      }

      .pane {
        padding: 1em;
        min-width: 200px;
      }

      .titlebar-icon {
        font-family: 'Material Symbols Outlined', sans-serif;
        font-size: 16px;
        color: #777;
        border-radius: 5px;
      }

      .gutter {
        width: 10px;
        height: 100%;
        background: #ccc;
        position: absolute;
        top: 0;
        left: 0;
        cursor: col-resize;
      }

      .main {
        flex: 1;
        overflow: auto;
        padding: 10px;
      }

      .sidebar {
        width: 300px;
        padding-top: 0px;
        position: relative;
        background-color: #f0f0f0;
        border-left: 1px solid #ccc;
        display: flex;
        flex-direction: column;
      }

      #buttons {
        display: flex;
        flex-direction: column;
      }

      .titlebar {
        background-color: #ddd;
        border-bottom: 1px solid #ccc;
        font-weight: bold;
        padding: 5px;
        display: flex;
      }

      .console {
        border-collapse: collapse;
        margin-top: 10px;
        width: 100%;
      }

      table.console td.timestamp {
        display: none;
      }

      table.console.timestamps td.timestamp {
        display: table-cell;
      }

      table.console td {
          color: rgba(0, 0, 0, 0.7);
      }

      table.console td .dispatched {
          font-weight: bold;
          color: rgba(0, 0, 0, 1);
      }

      table.console tr:has(+tr td .dispatched) {
          border-bottom: 0px;
      }

      table.console tr:has(+tr td .dispatched) td {
          padding-bottom: 25px;
      }

      .console th {
        background-color: #f0f0f0;
        border-bottom: 1px solid #ccc;
        font-weight: normal;
        padding: 5px;
        text-align: left;
      }

      .console tbody {
        font-family: monospace;
      }

      .console tr {
        border-bottom: 1px solid #ccc;
      }

      .console td {
        padding: 5px;
      }
  
      .console td.timestamp {
        font-size: small;
      }

      .history {
        margin-top: 30px;       
        display: flex;
        overflow: auto;    
        flex-direction: column-reverse;
      }

      .console tr:last-child td {
        border-bottom: none;
      }

      .dispatched {
        font-weight: bold;
      }

      .dispatched > .trigger {
        border: 1px solid #000;
        border-radius: 4px;
        padding: 2px 10px 2px 10px;
      }

      button {
        margin: 5px;
      }

      button.event-button {
        transition: opacity 0.3s ease, background-color 0.3s ease;
        opacity: 1;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }

      button.event-button:disabled {
        opacity: 0.4;
        background-color: #f0f0f0;
        color: #999;
        cursor: not-allowed;
      }

      button.event-button:not(:disabled):hover {
        background-color: #0056b3;
      }

      /* Style for hiding irrelevant events */
      button.event-button.hidden {
        display: none;
      }



      /* ----------------------------- Dropdown related start ----------------------------- */
      
      .dropdown-button {
        border: none;
        cursor: pointer;
      }
      
      .dropdown-button:hover, .dropdown-button:focus {
        background-color: #f1f1f1;
      }
      
      .dropdown {
        position: relative;
        display: inline-block;
        margin-left: auto;
      }
      
      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: #f1f1f1;
        min-width: 250px;
        overflow: auto;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
      }
      
      .dropdown-content .dropdown-item {
        display: block;
        padding: 12px 16px;
        font-weight: normal;
      }

      .dropdown-content .dropdown-item:hover {
        background-color: #ddd;
        cursor: pointer;
      }

      .show {
        display: block;
      }

      /* ----------------------------- Dropdown related end ----------------------------- */



      .transition.active {
        stroke: #fff5ad !important;
        stroke-width: 5px !important;
        filter: drop-shadow( 3px 3px 2px rgba(0, 0, 0, .7));
      }

      .statediagram-state.active > * {
        fill: #fff5ad !important;
        stroke-width: 2px !important;
      }

    </style>
  </head>

  <body>
    <div class="wrapper">
    <div class="pane main">
        <pre class="mermaid">
stateDiagram

Sate_Tilted

Sate_Tilted : Sate_Tilted

Sate_Tilted : enter / #123; StopWaterPump()#59; #125;

Sate_Tilted : enter / #123; StopUVLed()#59; #125;

Sate_Tilted : enter / #123; StopCarbonation()#59; #125;

Sate_Tilted : enter / #123; StartMalfunctionLedsSequence()#59; #125;

state State_AutomaticMode {

        State_Rinsing

        State_Rinsing : State_Rinsing

        State_Rinsing : enter / #123; ButtonsFunction(false)#59; #125;

        State_Rinsing : enter / #123; LedsSequence(LEDS_Rinsing)#59; #125;

        State_Rinsing : enter / #123; pumpStopsOnSensor = true#59; #125;

        State_Rinsing : enter / #123; SolenoidPumpUVPower(1)#59; #125;

        State_Rinsing : enter / #123; StartWaterPump()#59; #125;

        State_Rinsing : enter / #123; ResetFilterLifetimeTimer()#59; #125;

        State_Rinsing : enter / #123; StartWaterPumpingTimer()#59; #125;

        State_Rinsing : enter / #123; StartUVLEd()#59; #125;

        State_Rinsing : exit / #123; StopWaterPump()#59; #125;

        State_Rinsing : exit / #123; StopUVLed()#59; #125;

        State_ExitFilteringOnly

        State_ExitFilteringOnly : State_ExitFilteringOnly

        State_ExitFilteringOnly : enter / #123; SolenoidPumpUVPower(0)#59; #125;

        State_ExitFilteringOnly : enter / #123; StopWaterPump()#59; #125;

        State_ExitFilteringOnly : enter / #123; StopUVLed()#59; #125;

        state State_Carbonating {

                Sate_Start_Carbonating

                Sate_Start_Carbonating : Sate_Start_Carbonating

                Sate_Start_Carbonating : enter / #123; SolenoidPumpUVPower(1)#59; #125;

                Sate_Start_Carbonating : enter / #123; ButtonsFunction(false)#59; #125;

                Sate_Start_Carbonating : enter / #123; StartCarbonationLedSequance()#59; #125;

                Sate_Start_Carbonating : enter / #123; StartCarbonation()#59; #125;

                Sate_Start_Carbonating : enter / #123; carbCycle = 0#59; #125;

                %% Initial state name as "." so that it fits in black circle shape.
                %% See https://github.com/StateSmith/StateSmith/issues/404
                state "." as State_Carbonating.(InitialState)

                Sate_Carbonating_on

                Sate_Carbonating_on : Sate_Carbonating_on

                Sate_Carbonating_on : enter / #123; StartCarbStageTimer()#59; #125;

                Sate_Carbonating_on : enter / #123; SolenoidPump(1)#59; #125;

                Sate_Carbonating_off

                Sate_Carbonating_off : Sate_Carbonating_off

                Sate_Carbonating_off : enter / #123; StartCarbStageTimer()#59; #125;

                Sate_Carbonating_off : enter / #123; SolenoidPump(0)#59; #125;

                Sate_Carbonating_off : exit / #123; carbCycle++#59; #125;

                state State_Carbonating.(ChoicePoint)() <<choice>>

        }

        Sate_Exit_Carbonating

        Sate_Exit_Carbonating : Sate_Exit_Carbonating

        Sate_Exit_Carbonating : enter / #123; StopCarbonation()#59; #125;

        Sate_Exit_Carbonating : enter / #123; SolenoidPumpUVPower(0)#59; #125;

        State_Filtering

        State_Filtering : State_Filtering

        State_Filtering : enter / #123; ButtonsFunction(false)#59; #125;

        State_Filtering : enter / #123; LedsSequence(LEDS_StartMakeDring)#59; #125;

        State_Filtering : enter / #123; SolenoidPumpUVPower(1)#59; #125;

        State_Filtering : enter / #123; StartWaterFilterLedSequence()#59; #125;

        State_Filtering : enter / #123; StartUVLEd()#59; #125;

        State_Filtering : enter / #123; pumpStopsOnSensor = true#59; #125;

        State_Filtering : enter / #123; StartWaterPump()#59; #125;

        State_Filtering : enter / #123; StartWaterPumpingTimer()#59; #125;

        State_Filtering : exit / #123; StopWaterPump()#59; #125;

        State_Filtering : exit / #123; StopUVLed()#59; #125;

        state State_AutomaticMode.(ChoicePoint)() <<choice>>

        state State_AutomaticMode.(ChoicePoint)() <<choice>>

        State_MakeDrinkDone

        State_MakeDrinkDone : State_MakeDrinkDone

        State_MakeDrinkDone : enter / #123; LedsSequence(LEDS_DoneMakeDring)#59; #125;

        State_SetLevel

        State_SetLevel : State_SetLevel

        State_SetLevel : enter / #123; SetLevelLeds()#59; #125;

        state State_Awake {

                state State_Awake.(ChoicePoint)() <<choice>>

                State_Ready

                State_Ready : State_Ready

                State_Ready : enter / #123; StartReadyTimer()#59; #125;

                State_ReadyRinseRequired

                State_ReadyRinseRequired : State_ReadyRinseRequired

                State_ReadyRinseRequired : enter / #123; LedsSequence(LEDS_FilterState)#59; #125;

                State_ReadyRinseRequired : enter / #123; StartReadyTimer()#59; #125;

                %% Initial state name as "." so that it fits in black circle shape.
                %% See https://github.com/StateSmith/StateSmith/issues/404
                state "." as State_Awake.(InitialState)

                State_Splash

                State_Splash : State_Splash

                State_Splash : enter / #123; LedsSequence(LEDS_Splash)#59; #125;

                State_Splash : enter / #123; ButtonsFunction(true)#59; #125;

        }

        State_Sleeping

        State_Sleeping : State_Sleeping

        State_Sleeping : enter / #123; ButtonsFunction(false)#59; #125;

        State_Sleeping : enter / #123; FadeOutLeds(LEDS_all)#59; #125;

        state State_OOTBSetup {

                State_OOTBCO2Down

                State_OOTBCO2Down : State_OOTBCO2Down

                State_OOTBCO2Down : enter / #123; LedsSequence(LEDS_OOTBCO2Down)#59; #125;

                State_OOTBDisplayStatus

                State_OOTBDisplayStatus : State_OOTBDisplayStatus

                State_OOTBDisplayStatus : enter / #123; LedsSequence(LEDS_DisplayStatus)#59; #125;

                State_OOTBDisplayStatus : enter / #123; ButtonsFunction(true)#59; #125;

                %% Initial state name as "." so that it fits in black circle shape.
                %% See https://github.com/StateSmith/StateSmith/issues/404
                state "." as State_OOTBSetup.(InitialState)

                State_Startup

                State_Startup : State_Startup

                State_Startup : enter / #123; LedsSequence(LEDS_Splash)#59; #125;

                State_Startup : enter / #123; ButtonsFunction(false)#59; #125;

                State_SpashInterrupted

                State_SpashInterrupted : State_SpashInterrupted

                State_SpashInterrupted : enter / #123; LedsSequence(LEDS_allOff)#59; #125;

                State_OOTBFilterWarning

                State_OOTBFilterWarning : State_OOTBFilterWarning

                State_OOTBFilterWarning : enter / #123; LedsSequence(LEDS_FIlterWarning)#59; #125;

                State_OOTBFilterDown

                State_OOTBFilterDown : State_OOTBFilterDown

                State_OOTBFilterDown : enter / #123; LedsSequence(LEDS_OOTBFilterDown)#59; #125;

                State_OOTBSetLevel

                State_OOTBSetLevel : State_OOTBSetLevel

                State_OOTBSetLevel : enter / #123; LedsSequence(LEDS_CO2Warning)#59; #125;

                State_OOTBClearCO2Warn

                State_OOTBClearCO2Warn : State_OOTBClearCO2Warn

                State_OOTBClearCO2Warn : enter / #123; ClearCO2OOTBFlag()#59; #125;

                State_OOTBClearCO2Warn : enter / #123; LedsSequence(LEDS_StartUpCO2)#59; #125;

        }

        state State_AutomaticMode.(ChoicePoint)(OOTBorNormal) <<choice>>

        %% Initial state name as "." so that it fits in black circle shape.
        %% See https://github.com/StateSmith/StateSmith/issues/404
        state "." as State_AutomaticMode.(InitialState)

}

Sate_SafetyFail

Sate_SafetyFail : Sate_SafetyFail

Sate_SafetyFail : enter / #123; StopWaterPump()#59; #125;

Sate_SafetyFail : enter / #123; StopUVLed()#59; #125;

Sate_SafetyFail : enter / #123; StopCarbonation()#59; #125;

Sate_SafetyFail : enter / #123; StartMalfunctionLedsSequence()#59; #125;

%% Initial state name as "." so that it fits in black circle shape.
%% See https://github.com/StateSmith/StateSmith/issues/404
state "." as ROOT.(InitialState)

Sate_HWWatchdog

Sate_HWWatchdog : Sate_HWWatchdog

Sate_HWWatchdog : enter / #123; StopWaterPump()#59; #125;

Sate_HWWatchdog : enter / #123; StopUVLed()#59; #125;

Sate_HWWatchdog : enter / #123; StopCarbonation()#59; #125;

Sate_HWWatchdog : enter / #123; StartMalfunctionLedsSequence()#59; #125;

state Stat_GUIControlMode {

        %% Initial state name as "." so that it fits in black circle shape.
        %% See https://github.com/StateSmith/StateSmith/issues/404
        state "." as Stat_GUIControlMode.(InitialState)

        State_GuiModeWaitCommands

        State_GuiModeWaitCommands : State_GuiModeWaitCommands

        state Stat_GUIControlMode.(ChoicePoint)() <<choice>>

        State_StopWaterPump

        State_StopWaterPump : State_StopWaterPump

        State_StopWaterPump : enter / #123; StopWaterPump()#59; #125;

        State_StopWaterPump : enter / #123; SendDonePumpOK()#59; #125;

        State_StopWaterPump : enter / #123; pumpStopsOnSensor = false#59; #125;

}

Sate_Tilted --> Sate_HWWatchdog : Event_HWWatchdog

Sate_Tilted --> Sate_SafetyFail : Event_SafetyFail

Sate_Tilted --> State_Awake : do [! Tilted()]

State_AutomaticMode --> Sate_Tilted : do [Tilted()]

State_AutomaticMode --> Sate_HWWatchdog : Event_HWWatchdog

State_AutomaticMode --> Sate_SafetyFail : Event_SafetyFail

State_AutomaticMode --> Stat_GUIControlMode : Event_Enter_GUI_Controlled_Mode

State_Rinsing --> State_AutomaticMode.(ChoicePoint)(OOTBorNormal) : do [IsBottleFull()||WaterPumpTimerExpired()]

State_Rinsing --> State_AutomaticMode.(ChoicePoint)(OOTBorNormal) : Event_AnyKeyPress

State_ExitFilteringOnly --> State_MakeDrinkDone : do

State_Carbonating --> Sate_Exit_Carbonating : Event_AnyKeyPress

Sate_Start_Carbonating --> Sate_Carbonating_on : do

State_Carbonating.(InitialState) --> Sate_Start_Carbonating

Sate_Carbonating_on --> Sate_Carbonating_off : do [CarbonationOnCycleExpired(carbCycle)]

Sate_Carbonating_off --> State_Carbonating.(ChoicePoint)() : do [CarbonationOffCycleExpired(carbCycle)]

State_Carbonating.(ChoicePoint)() --> Sate_Carbonating_on : else

State_Carbonating.(ChoicePoint)() --> Sate_Exit_Carbonating : [IsCarbonationLastCycle(carbCycle)]

Sate_Exit_Carbonating --> State_MakeDrinkDone : do

State_Filtering --> State_ExitFilteringOnly : do [WaterPumpTimerExpired()]

State_Filtering --> State_ExitFilteringOnly : Event_AnyKeyPress

State_Filtering --> State_AutomaticMode.(ChoicePoint)() : do [IsBottleFull()]

State_AutomaticMode.(ChoicePoint)() --> State_AutomaticMode.(ChoicePoint)() : [IsBottleFull()]

State_AutomaticMode.(ChoicePoint)() --> State_Filtering : else

State_AutomaticMode.(ChoicePoint)() --> State_ExitFilteringOnly : else

State_AutomaticMode.(ChoicePoint)() --> State_Carbonating : [CarbonationEnabled()]

State_MakeDrinkDone --> State_Awake : do

State_SetLevel --> State_Awake : do

State_Awake --> State_SetLevel : Event_CarbLevelShortPressed

State_Awake --> State_Rinsing : Event_FilterButtonLongPressed

State_Awake --> State_AutomaticMode.(ChoicePoint)() : Event_PrimaryButtonPressed

State_Awake.(ChoicePoint)() --> State_Ready : else

State_Awake.(ChoicePoint)() --> State_ReadyRinseRequired : [IsFirstPowerON() || FilterLifeTimeExpired()]

State_Ready --> State_Awake.(ChoicePoint)() : Event_FilterButtonShortPressed

State_Ready --> State_Sleeping : do [ReadyTimerExpired()]

State_ReadyRinseRequired --> State_Awake.(ChoicePoint)() : Event_FilterButtonShortPressed

State_ReadyRinseRequired --> State_Sleeping : do [ReadyTimerExpired()]

State_Awake.(InitialState) --> State_Splash

State_Splash --> State_Awake.(ChoicePoint)() : do

State_Sleeping --> State_Awake : Event_AnyKeyPress

State_OOTBCO2Down --> State_OOTBSetLevel : Event_CarbLevelShortPressed

State_OOTBCO2Down --> State_OOTBClearCO2Warn : Event_CarbLevelLongPressed

State_OOTBDisplayStatus --> State_OOTBCO2Down : Event_CarbLevelDown

State_OOTBDisplayStatus --> State_OOTBFilterDown : Event_FilterDown

State_OOTBSetup.(InitialState) --> State_Startup

State_Startup --> State_OOTBDisplayStatus : do [!IsLedsSequencePlaying()]

State_Startup --> State_SpashInterrupted : Event_AnyKeyPress

State_SpashInterrupted --> State_OOTBDisplayStatus : do [!IsLedsSequencePlaying()]

State_OOTBFilterWarning --> State_OOTBDisplayStatus : do [!IsLedsSequencePlaying()]

State_OOTBFilterDown --> State_OOTBFilterWarning : Event_FilterButtonShortPressed

State_OOTBFilterDown --> State_Rinsing : Event_FilterButtonLongPressed

State_OOTBSetLevel --> State_OOTBDisplayStatus : do [!IsLedsSequencePlaying()]

State_OOTBClearCO2Warn --> State_AutomaticMode.(ChoicePoint)(OOTBorNormal) : do [!IsLedsSequencePlaying()]

State_AutomaticMode.(ChoicePoint)(OOTBorNormal) --> State_OOTBSetup : [IsOOTBState()]

State_AutomaticMode.(ChoicePoint)(OOTBorNormal) --> State_Awake : else

State_AutomaticMode.(InitialState) --> State_AutomaticMode.(ChoicePoint)(OOTBorNormal)

ROOT.(InitialState) --> State_AutomaticMode

Stat_GUIControlMode --> State_AutomaticMode : Event_Exit_GUI_Controlled_Mode

Stat_GUIControlMode --> Sate_HWWatchdog : Event_HWWatchdog

Stat_GUIControlMode.(InitialState) --> State_GuiModeWaitCommands

State_GuiModeWaitCommands --> Stat_GUIControlMode.(ChoicePoint)() : Event_BottleFullSensor

Stat_GUIControlMode.(ChoicePoint)() --> State_StopWaterPump : [pumpStopsOnSensor]

Stat_GUIControlMode.(ChoicePoint)() --> State_GuiModeWaitCommands : else

State_StopWaterPump --> State_GuiModeWaitCommands : do



        </pre>
    </div>

    <div class="pane sidebar">
      <div id="buttons">
        <div class="titlebar">Events
          <div class='dropdown'>
            <span id='dropdown-button' class='titlebar-icon dropdown-button'>settings</span>
            <div id='myDropdown' class='dropdown-content'>
              <label class='dropdown-item' for='hideIrrelevantEvents'
                title='When enabled, event dispatching buttons will be hidden if the current active state(s) ignore the event.'>
                <input type='checkbox' id='hideIrrelevantEvents' name='hideIrrelevantEvents'>
                Hide ignored event buttons
              </label>
              <label class='dropdown-item' for='timestamps'
                title='Controls whether timestamps are shown along side event dispatches.'>
                <input type='checkbox' id='timestamps' name='timestamps'>
                Timestamps
              </label>
            </div>
          </div>
        </div>
      </div>
    
      <div class="history">
        <table class="console">
          <tbody>
          </tbody>
        </table>
      </div>
    
      <div class="gutter"></div>
    </div>
    </div>

<script>
// Autogenerated with StateSmith 0.18.0+34a94a5de0bf3f5f53012c58cebeef3eea5dac04.
// Algorithm: Balanced2. See https://github.com/StateSmith/StateSmith/wiki/Algorithms

// Generated state machine
class SMSodaStreamPure
{
// Null by default.
// May be overridden to override guard evaluation (eg. in a simulator)
evaluateGuard = null;
    static EventId = 
    {
        DO : 0, // The `do` event is special. State event handlers do not consume this event (ancestors all get it too) unless a transition occurs.
        EVENT_ANYKEYPRESS : 1,
        EVENT_BOTTLEFULLSENSOR : 2,
        EVENT_CARBLEVELDOWN : 3,
        EVENT_CARBLEVELLONGPRESSED : 4,
        EVENT_CARBLEVELSHORTPRESSED : 5,
        EVENT_ENTER_GUI_CONTROLLED_MODE : 6,
        EVENT_EXIT_GUI_CONTROLLED_MODE : 7,
        EVENT_FILTERBUTTONLONGPRESSED : 8,
        EVENT_FILTERBUTTONSHORTPRESSED : 9,
        EVENT_FILTERDOWN : 10,
        EVENT_HWWATCHDOG : 11,
        EVENT_PRIMARYBUTTONPRESSED : 12,
        EVENT_SAFETYFAIL : 13,
    }
    static { Object.freeze(this.EventId); }
    
    static EventIdCount = 14;
    static { Object.freeze(this.EventIdCount); }
    
    static StateId = 
    {
        ROOT : 0,
        SATE_HWWATCHDOG : 1,
        SATE_SAFETYFAIL : 2,
        SATE_TILTED : 3,
        STAT_GUICONTROLMODE : 4,
        STATE_GUIMODEWAITCOMMANDS : 5,
        STATE_STOPWATERPUMP : 6,
        STATE_AUTOMATICMODE : 7,
        SATE_EXIT_CARBONATING : 8,
        STATE_AWAKE : 9,
        STATE_READY : 10,
        STATE_READYRINSEREQUIRED : 11,
        STATE_SPLASH : 12,
        STATE_CARBONATING : 13,
        SATE_CARBONATING_OFF : 14,
        SATE_CARBONATING_ON : 15,
        SATE_START_CARBONATING : 16,
        STATE_EXITFILTERINGONLY : 17,
        STATE_FILTERING : 18,
        STATE_MAKEDRINKDONE : 19,
        STATE_OOTBSETUP : 20,
        STATE_OOTBCLEARCO2WARN : 21,
        STATE_OOTBCO2DOWN : 22,
        STATE_OOTBDISPLAYSTATUS : 23,
        STATE_OOTBFILTERDOWN : 24,
        STATE_OOTBFILTERWARNING : 25,
        STATE_OOTBSETLEVEL : 26,
        STATE_SPASHINTERRUPTED : 27,
        STATE_STARTUP : 28,
        STATE_RINSING : 29,
        STATE_SETLEVEL : 30,
        STATE_SLEEPING : 31,
    }
    static { Object.freeze(this.StateId); }
    
    static StateIdCount = 32;
    static { Object.freeze(this.StateIdCount); }
    
    // Used internally by state machine. Feel free to inspect, but don't modify.
    stateId;
    
    // Starts the state machine. Must be called before dispatching events. Not thread safe.
    start()
    {
        this.#ROOT_enter();
        // ROOT behavior
        // uml: TransitionTo(ROOT.<InitialState>)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: ``.
            
            // Step 3: Enter/move towards transition target `ROOT.<InitialState>`.
            // ROOT.<InitialState> is a pseudo state and cannot have an `enter` trigger.
            
            // ROOT.<InitialState> behavior
            // uml: / { this.tracer?.edgeTransition("edge55"); } TransitionTo(State_AutomaticMode)
            {
                // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge55");`.
                this.tracer?.edgeTransition("edge55");
                
                // Step 3: Enter/move towards transition target `State_AutomaticMode`.
                this.#STATE_AUTOMATICMODE_enter();
                
                // Finish transition by calling pseudo state transition function.
                this.#State_AutomaticMode_InitialState_transition();
                return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
            } // end of behavior for ROOT.<InitialState>
        } // end of behavior for ROOT
    }
    
    // Dispatches an event to the state machine. Not thread safe.
    // Note! This function assumes that the `eventId` parameter is valid.
    dispatchEvent(eventId)
    {
        switch (this.stateId)
        {
            // STATE: SMSodaStreamPure
            case SMSodaStreamPure.StateId.ROOT:
                // No events handled by this state (or its ancestors).
                break;
            
            // STATE: Sate_HWWatchdog
            case SMSodaStreamPure.StateId.SATE_HWWATCHDOG:
                // No events handled by this state (or its ancestors).
                break;
            
            // STATE: Sate_SafetyFail
            case SMSodaStreamPure.StateId.SATE_SAFETYFAIL:
                // No events handled by this state (or its ancestors).
                break;
            
            // STATE: Sate_Tilted
            case SMSodaStreamPure.StateId.SATE_TILTED:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#SATE_TILTED_event_hwwatchdog(); break;
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#SATE_TILTED_event_safetyfail(); break;
                    case SMSodaStreamPure.EventId.DO: this.#SATE_TILTED_do(); break;
                }
                break;
            
            // STATE: Stat_GUIControlMode
            case SMSodaStreamPure.StateId.STAT_GUICONTROLMODE:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_EXIT_GUI_CONTROLLED_MODE: this.#STAT_GUICONTROLMODE_event_exit_gui_controlled_mode(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STAT_GUICONTROLMODE_event_hwwatchdog(); break;
                }
                break;
            
            // STATE: State_GuiModeWaitCommands
            case SMSodaStreamPure.StateId.STATE_GUIMODEWAITCOMMANDS:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_BOTTLEFULLSENSOR: this.#STATE_GUIMODEWAITCOMMANDS_event_bottlefullsensor(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STAT_GUICONTROLMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_EXIT_GUI_CONTROLLED_MODE: this.#STAT_GUICONTROLMODE_event_exit_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_StopWaterPump
            case SMSodaStreamPure.StateId.STATE_STOPWATERPUMP:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_STOPWATERPUMP_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STAT_GUICONTROLMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_EXIT_GUI_CONTROLLED_MODE: this.#STAT_GUICONTROLMODE_event_exit_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_AutomaticMode
            case SMSodaStreamPure.StateId.STATE_AUTOMATICMODE:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break;
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break;
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break;
                }
                break;
            
            // STATE: Sate_Exit_Carbonating
            case SMSodaStreamPure.StateId.SATE_EXIT_CARBONATING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#SATE_EXIT_CARBONATING_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Awake
            case SMSodaStreamPure.StateId.STATE_AWAKE:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: this.#STATE_AWAKE_event_carblevelshortpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: this.#STATE_AWAKE_event_filterbuttonlongpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_PRIMARYBUTTONPRESSED: this.#STATE_AWAKE_event_primarybuttonpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Ready
            case SMSodaStreamPure.StateId.STATE_READY:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONSHORTPRESSED: this.#STATE_READY_event_filterbuttonshortpressed(); break;
                    case SMSodaStreamPure.EventId.DO: this.#STATE_READY_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: this.#STATE_AWAKE_event_carblevelshortpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: this.#STATE_AWAKE_event_filterbuttonlongpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_PRIMARYBUTTONPRESSED: this.#STATE_AWAKE_event_primarybuttonpressed(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_ReadyRinseRequired
            case SMSodaStreamPure.StateId.STATE_READYRINSEREQUIRED:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONSHORTPRESSED: this.#STATE_READYRINSEREQUIRED_event_filterbuttonshortpressed(); break;
                    case SMSodaStreamPure.EventId.DO: this.#STATE_READYRINSEREQUIRED_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: this.#STATE_AWAKE_event_carblevelshortpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: this.#STATE_AWAKE_event_filterbuttonlongpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_PRIMARYBUTTONPRESSED: this.#STATE_AWAKE_event_primarybuttonpressed(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Splash
            case SMSodaStreamPure.StateId.STATE_SPLASH:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_SPLASH_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: this.#STATE_AWAKE_event_carblevelshortpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: this.#STATE_AWAKE_event_filterbuttonlongpressed(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_PRIMARYBUTTONPRESSED: this.#STATE_AWAKE_event_primarybuttonpressed(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Carbonating
            case SMSodaStreamPure.StateId.STATE_CARBONATING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_CARBONATING_event_anykeypress(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: Sate_Carbonating_off
            case SMSodaStreamPure.StateId.SATE_CARBONATING_OFF:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#SATE_CARBONATING_OFF_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_CARBONATING_event_anykeypress(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: Sate_Carbonating_on
            case SMSodaStreamPure.StateId.SATE_CARBONATING_ON:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#SATE_CARBONATING_ON_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_CARBONATING_event_anykeypress(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: Sate_Start_Carbonating
            case SMSodaStreamPure.StateId.SATE_START_CARBONATING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#SATE_START_CARBONATING_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_CARBONATING_event_anykeypress(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_ExitFilteringOnly
            case SMSodaStreamPure.StateId.STATE_EXITFILTERINGONLY:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_EXITFILTERINGONLY_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Filtering
            case SMSodaStreamPure.StateId.STATE_FILTERING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_FILTERING_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_FILTERING_event_anykeypress(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_MakeDrinkDone
            case SMSodaStreamPure.StateId.STATE_MAKEDRINKDONE:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_MAKEDRINKDONE_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBSetup
            case SMSodaStreamPure.StateId.STATE_OOTBSETUP:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBClearCO2Warn
            case SMSodaStreamPure.StateId.STATE_OOTBCLEARCO2WARN:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_OOTBCLEARCO2WARN_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBCO2Down
            case SMSodaStreamPure.StateId.STATE_OOTBCO2DOWN:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: this.#STATE_OOTBCO2DOWN_event_carblevelshortpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELLONGPRESSED: this.#STATE_OOTBCO2DOWN_event_carblevellongpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBDisplayStatus
            case SMSodaStreamPure.StateId.STATE_OOTBDISPLAYSTATUS:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_CARBLEVELDOWN: this.#STATE_OOTBDISPLAYSTATUS_event_carbleveldown(); break;
                    case SMSodaStreamPure.EventId.EVENT_FILTERDOWN: this.#STATE_OOTBDISPLAYSTATUS_event_filterdown(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBFilterDown
            case SMSodaStreamPure.StateId.STATE_OOTBFILTERDOWN:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONSHORTPRESSED: this.#STATE_OOTBFILTERDOWN_event_filterbuttonshortpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: this.#STATE_OOTBFILTERDOWN_event_filterbuttonlongpressed(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBFilterWarning
            case SMSodaStreamPure.StateId.STATE_OOTBFILTERWARNING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_OOTBFILTERWARNING_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_OOTBSetLevel
            case SMSodaStreamPure.StateId.STATE_OOTBSETLEVEL:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_OOTBSETLEVEL_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_SpashInterrupted
            case SMSodaStreamPure.StateId.STATE_SPASHINTERRUPTED:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_SPASHINTERRUPTED_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Startup
            case SMSodaStreamPure.StateId.STATE_STARTUP:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_STARTUP_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_STARTUP_event_anykeypress(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Rinsing
            case SMSodaStreamPure.StateId.STATE_RINSING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_RINSING_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_RINSING_event_anykeypress(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_SetLevel
            case SMSodaStreamPure.StateId.STATE_SETLEVEL:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.DO: this.#STATE_SETLEVEL_do(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
            
            // STATE: State_Sleeping
            case SMSodaStreamPure.StateId.STATE_SLEEPING:
                switch (eventId)
                {
                    case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: this.#STATE_SLEEPING_event_anykeypress(); break;
                    case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: this.#STATE_AUTOMATICMODE_event_hwwatchdog(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: this.#STATE_AUTOMATICMODE_event_safetyfail(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.DO: this.#STATE_AUTOMATICMODE_do(); break; // First ancestor handler for this event
                    case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: this.#STATE_AUTOMATICMODE_event_enter_gui_controlled_mode(); break; // First ancestor handler for this event
                }
                break;
        }
        
    }
    
    // This function is used when StateSmith doesn't know what the active leaf state is at
    // compile time due to sub states or when multiple states need to be exited.
    #exitUpToStateHandler(desiredState)
    {
        while (this.stateId != desiredState)
        {
            switch (this.stateId)
            {
                case SMSodaStreamPure.StateId.SATE_HWWATCHDOG: this.#SATE_HWWATCHDOG_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_SAFETYFAIL: this.#SATE_SAFETYFAIL_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_TILTED: this.#SATE_TILTED_exit(); break;
                
                case SMSodaStreamPure.StateId.STAT_GUICONTROLMODE: this.#STAT_GUICONTROLMODE_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_GUIMODEWAITCOMMANDS: this.#STATE_GUIMODEWAITCOMMANDS_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_STOPWATERPUMP: this.#STATE_STOPWATERPUMP_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_AUTOMATICMODE: this.#STATE_AUTOMATICMODE_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_EXIT_CARBONATING: this.#SATE_EXIT_CARBONATING_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_AWAKE: this.#STATE_AWAKE_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_READY: this.#STATE_READY_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_READYRINSEREQUIRED: this.#STATE_READYRINSEREQUIRED_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_SPLASH: this.#STATE_SPLASH_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_CARBONATING: this.#STATE_CARBONATING_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_CARBONATING_OFF: this.#SATE_CARBONATING_OFF_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_CARBONATING_ON: this.#SATE_CARBONATING_ON_exit(); break;
                
                case SMSodaStreamPure.StateId.SATE_START_CARBONATING: this.#SATE_START_CARBONATING_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_EXITFILTERINGONLY: this.#STATE_EXITFILTERINGONLY_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_FILTERING: this.#STATE_FILTERING_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_MAKEDRINKDONE: this.#STATE_MAKEDRINKDONE_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBSETUP: this.#STATE_OOTBSETUP_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBCLEARCO2WARN: this.#STATE_OOTBCLEARCO2WARN_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBCO2DOWN: this.#STATE_OOTBCO2DOWN_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBDISPLAYSTATUS: this.#STATE_OOTBDISPLAYSTATUS_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBFILTERDOWN: this.#STATE_OOTBFILTERDOWN_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBFILTERWARNING: this.#STATE_OOTBFILTERWARNING_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_OOTBSETLEVEL: this.#STATE_OOTBSETLEVEL_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_SPASHINTERRUPTED: this.#STATE_SPASHINTERRUPTED_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_STARTUP: this.#STATE_STARTUP_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_RINSING: this.#STATE_RINSING_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_SETLEVEL: this.#STATE_SETLEVEL_exit(); break;
                
                case SMSodaStreamPure.StateId.STATE_SLEEPING: this.#STATE_SLEEPING_exit(); break;
                
                default: return;  // Just to be safe. Prevents infinite loop if state ID memory is somehow corrupted.
            }
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state ROOT
    ////////////////////////////////////////////////////////////////////////////////
    
    #ROOT_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_HWWATCHDOG
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_HWWATCHDOG_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_HWWATCHDOG;
        
        // Sate_HWWatchdog behavior
        // uml: enter / { this.tracer?.enterState('Sate_HWWatchdog'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_HWWatchdog');`
            this.tracer?.enterState('Sate_HWWatchdog');
        } // end of behavior for Sate_HWWatchdog
        
        // Sate_HWWatchdog behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for Sate_HWWatchdog
        
        // Sate_HWWatchdog behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for Sate_HWWatchdog
        
        // Sate_HWWatchdog behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopCarbonation();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");`
            this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");
        } // end of behavior for Sate_HWWatchdog
        
        // Sate_HWWatchdog behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");`
            this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");
        } // end of behavior for Sate_HWWatchdog
    }
    
    #SATE_HWWATCHDOG_exit()
    {
        // Sate_HWWatchdog behavior
        // uml: exit / { this.tracer?.exitState('Sate_HWWatchdog'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_HWWatchdog');`
            this.tracer?.exitState('Sate_HWWatchdog');
        } // end of behavior for Sate_HWWatchdog
        
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_SAFETYFAIL
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_SAFETYFAIL_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_SAFETYFAIL;
        
        // Sate_SafetyFail behavior
        // uml: enter / { this.tracer?.enterState('Sate_SafetyFail'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_SafetyFail');`
            this.tracer?.enterState('Sate_SafetyFail');
        } // end of behavior for Sate_SafetyFail
        
        // Sate_SafetyFail behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for Sate_SafetyFail
        
        // Sate_SafetyFail behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for Sate_SafetyFail
        
        // Sate_SafetyFail behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopCarbonation();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");`
            this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");
        } // end of behavior for Sate_SafetyFail
        
        // Sate_SafetyFail behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");`
            this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");
        } // end of behavior for Sate_SafetyFail
    }
    
    #SATE_SAFETYFAIL_exit()
    {
        // Sate_SafetyFail behavior
        // uml: exit / { this.tracer?.exitState('Sate_SafetyFail'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_SafetyFail');`
            this.tracer?.exitState('Sate_SafetyFail');
        } // end of behavior for Sate_SafetyFail
        
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_TILTED
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_TILTED_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_TILTED;
        
        // Sate_Tilted behavior
        // uml: enter / { this.tracer?.enterState('Sate_Tilted'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_Tilted');`
            this.tracer?.enterState('Sate_Tilted');
        } // end of behavior for Sate_Tilted
        
        // Sate_Tilted behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for Sate_Tilted
        
        // Sate_Tilted behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for Sate_Tilted
        
        // Sate_Tilted behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopCarbonation();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");`
            this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");
        } // end of behavior for Sate_Tilted
        
        // Sate_Tilted behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");`
            this.tracer?.log(" FSM would execute action: " + "StartMalfunctionLedsSequence();");
        } // end of behavior for Sate_Tilted
    }
    
    #SATE_TILTED_exit()
    {
        // Sate_Tilted behavior
        // uml: exit / { this.tracer?.exitState('Sate_Tilted'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_Tilted');`
            this.tracer?.exitState('Sate_Tilted');
        } // end of behavior for Sate_Tilted
        
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    #SATE_TILTED_do()
    {
        // Sate_Tilted behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "! Tilted()") || this.evaluateGuard("Sate_Tilted","do [! Tilted()] TransitionTo(State_Awake)")] / { this.tracer?.edgeTransition("edge2"); } TransitionTo(State_Awake)
        if (this.tracer?.log(" User evaluating guard: " + "! Tilted()") || this.evaluateGuard("Sate_Tilted","do [! Tilted()] TransitionTo(State_Awake)"))
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#SATE_TILTED_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge2");`.
            this.tracer?.edgeTransition("edge2");
            
            // Step 3: Enter/move towards transition target `State_Awake`.
            this.#STATE_AUTOMATICMODE_enter();
            this.#STATE_AWAKE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for Sate_Tilted
        
        // No ancestor handles this event.
    }
    
    #SATE_TILTED_event_hwwatchdog()
    {
        // Sate_Tilted behavior
        // uml: Event_HWWatchdog / { this.tracer?.edgeTransition("edge0"); } TransitionTo(Sate_HWWatchdog)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#SATE_TILTED_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge0");`.
            this.tracer?.edgeTransition("edge0");
            
            // Step 3: Enter/move towards transition target `Sate_HWWatchdog`.
            this.#SATE_HWWATCHDOG_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Sate_Tilted
        
        // No ancestor handles this event.
    }
    
    #SATE_TILTED_event_safetyfail()
    {
        // Sate_Tilted behavior
        // uml: Event_SafetyFail / { this.tracer?.edgeTransition("edge1"); } TransitionTo(Sate_SafetyFail)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#SATE_TILTED_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge1");`.
            this.tracer?.edgeTransition("edge1");
            
            // Step 3: Enter/move towards transition target `Sate_SafetyFail`.
            this.#SATE_SAFETYFAIL_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Sate_Tilted
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STAT_GUICONTROLMODE
    ////////////////////////////////////////////////////////////////////////////////
    
    #STAT_GUICONTROLMODE_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STAT_GUICONTROLMODE;
        
        // Stat_GUIControlMode behavior
        // uml: enter / { this.tracer?.enterState('Stat_GUIControlMode'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Stat_GUIControlMode');`
            this.tracer?.enterState('Stat_GUIControlMode');
        } // end of behavior for Stat_GUIControlMode
    }
    
    #STAT_GUICONTROLMODE_exit()
    {
        // Stat_GUIControlMode behavior
        // uml: exit / { this.tracer?.exitState('Stat_GUIControlMode'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Stat_GUIControlMode');`
            this.tracer?.exitState('Stat_GUIControlMode');
        } // end of behavior for Stat_GUIControlMode
        
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    #STAT_GUICONTROLMODE_event_exit_gui_controlled_mode()
    {
        // Stat_GUIControlMode behavior
        // uml: Event_Exit_GUI_Controlled_Mode / { this.tracer?.edgeTransition("edge56"); } TransitionTo(State_AutomaticMode)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge56");`.
            this.tracer?.edgeTransition("edge56");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode`.
            this.#STATE_AUTOMATICMODE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for Stat_GUIControlMode
        
        // No ancestor handles this event.
    }
    
    #STAT_GUICONTROLMODE_event_hwwatchdog()
    {
        // Stat_GUIControlMode behavior
        // uml: Event_HWWatchdog / { this.tracer?.edgeTransition("edge57"); } TransitionTo(Sate_HWWatchdog)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge57");`.
            this.tracer?.edgeTransition("edge57");
            
            // Step 3: Enter/move towards transition target `Sate_HWWatchdog`.
            this.#SATE_HWWATCHDOG_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Stat_GUIControlMode
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_GUIMODEWAITCOMMANDS
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_GUIMODEWAITCOMMANDS_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_GUIMODEWAITCOMMANDS;
        
        // State_GuiModeWaitCommands behavior
        // uml: enter / { this.tracer?.enterState('State_GuiModeWaitCommands'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_GuiModeWaitCommands');`
            this.tracer?.enterState('State_GuiModeWaitCommands');
        } // end of behavior for State_GuiModeWaitCommands
    }
    
    #STATE_GUIMODEWAITCOMMANDS_exit()
    {
        // State_GuiModeWaitCommands behavior
        // uml: exit / { this.tracer?.exitState('State_GuiModeWaitCommands'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_GuiModeWaitCommands');`
            this.tracer?.exitState('State_GuiModeWaitCommands');
        } // end of behavior for State_GuiModeWaitCommands
        
        this.stateId = SMSodaStreamPure.StateId.STAT_GUICONTROLMODE;
    }
    
    #STATE_GUIMODEWAITCOMMANDS_event_bottlefullsensor()
    {
        // State_GuiModeWaitCommands behavior
        // uml: Event_BottleFullSensor / { this.tracer?.edgeTransition("edge59"); } TransitionTo(Stat_GUIControlMode.<ChoicePoint>())
        {
            // Step 1: Exit states until we reach `Stat_GUIControlMode` state (Least Common Ancestor for transition).
            this.#STATE_GUIMODEWAITCOMMANDS_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge59");`.
            this.tracer?.edgeTransition("edge59");
            
            // Step 3: Enter/move towards transition target `Stat_GUIControlMode.<ChoicePoint>()`.
            // Stat_GUIControlMode.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // Stat_GUIControlMode.<ChoicePoint>() behavior
            // uml: [this.tracer?.log(" User evaluating guard: " + "pumpStopsOnSensor") || this.evaluateGuard("Stat_GUIControlMode.<ChoicePoint>()","[pumpStopsOnSensor] TransitionTo(State_StopWaterPump)")] / { this.tracer?.edgeTransition("edge60"); } TransitionTo(State_StopWaterPump)
            if (this.tracer?.log(" User evaluating guard: " + "pumpStopsOnSensor") || this.evaluateGuard("Stat_GUIControlMode.<ChoicePoint>()","[pumpStopsOnSensor] TransitionTo(State_StopWaterPump)"))
            {
                // Step 1: Exit states until we reach `Stat_GUIControlMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge60");`.
                this.tracer?.edgeTransition("edge60");
                
                // Step 3: Enter/move towards transition target `State_StopWaterPump`.
                this.#STATE_STOPWATERPUMP_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for Stat_GUIControlMode.<ChoicePoint>()
            
            // Stat_GUIControlMode.<ChoicePoint>() behavior
            // uml: else / { this.tracer?.edgeTransition("edge61"); } TransitionTo(State_GuiModeWaitCommands)
            {
                // Step 1: Exit states until we reach `Stat_GUIControlMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge61");`.
                this.tracer?.edgeTransition("edge61");
                
                // Step 3: Enter/move towards transition target `State_GuiModeWaitCommands`.
                this.#STATE_GUIMODEWAITCOMMANDS_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for Stat_GUIControlMode.<ChoicePoint>()
        } // end of behavior for State_GuiModeWaitCommands
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_STOPWATERPUMP
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_STOPWATERPUMP_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_STOPWATERPUMP;
        
        // State_StopWaterPump behavior
        // uml: enter / { this.tracer?.enterState('State_StopWaterPump'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_StopWaterPump');`
            this.tracer?.enterState('State_StopWaterPump');
        } // end of behavior for State_StopWaterPump
        
        // State_StopWaterPump behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for State_StopWaterPump
        
        // State_StopWaterPump behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SendDonePumpOK();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SendDonePumpOK();");`
            this.tracer?.log(" FSM would execute action: " + "SendDonePumpOK();");
        } // end of behavior for State_StopWaterPump
        
        // State_StopWaterPump behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = false;"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = false;");`
            this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = false;");
        } // end of behavior for State_StopWaterPump
    }
    
    #STATE_STOPWATERPUMP_exit()
    {
        // State_StopWaterPump behavior
        // uml: exit / { this.tracer?.exitState('State_StopWaterPump'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_StopWaterPump');`
            this.tracer?.exitState('State_StopWaterPump');
        } // end of behavior for State_StopWaterPump
        
        this.stateId = SMSodaStreamPure.StateId.STAT_GUICONTROLMODE;
    }
    
    #STATE_STOPWATERPUMP_do()
    {
        // State_StopWaterPump behavior
        // uml: do / { this.tracer?.edgeTransition("edge62"); } TransitionTo(State_GuiModeWaitCommands)
        {
            // Step 1: Exit states until we reach `Stat_GUIControlMode` state (Least Common Ancestor for transition).
            this.#STATE_STOPWATERPUMP_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge62");`.
            this.tracer?.edgeTransition("edge62");
            
            // Step 3: Enter/move towards transition target `State_GuiModeWaitCommands`.
            this.#STATE_GUIMODEWAITCOMMANDS_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_StopWaterPump
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_AUTOMATICMODE
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_AUTOMATICMODE_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
        
        // State_AutomaticMode behavior
        // uml: enter / { this.tracer?.enterState('State_AutomaticMode'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_AutomaticMode');`
            this.tracer?.enterState('State_AutomaticMode');
        } // end of behavior for State_AutomaticMode
    }
    
    #STATE_AUTOMATICMODE_exit()
    {
        // State_AutomaticMode behavior
        // uml: exit / { this.tracer?.exitState('State_AutomaticMode'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_AutomaticMode');`
            this.tracer?.exitState('State_AutomaticMode');
        } // end of behavior for State_AutomaticMode
        
        this.stateId = SMSodaStreamPure.StateId.ROOT;
    }
    
    #STATE_AUTOMATICMODE_do()
    {
        // State_AutomaticMode behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "Tilted()") || this.evaluateGuard("State_AutomaticMode","do [Tilted()] TransitionTo(Sate_Tilted)")] / { this.tracer?.edgeTransition("edge3"); } TransitionTo(Sate_Tilted)
        if (this.tracer?.log(" User evaluating guard: " + "Tilted()") || this.evaluateGuard("State_AutomaticMode","do [Tilted()] TransitionTo(Sate_Tilted)"))
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge3");`.
            this.tracer?.edgeTransition("edge3");
            
            // Step 3: Enter/move towards transition target `Sate_Tilted`.
            this.#SATE_TILTED_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_AutomaticMode
        
        // No ancestor handles this event.
    }
    
    #STATE_AUTOMATICMODE_event_enter_gui_controlled_mode()
    {
        // State_AutomaticMode behavior
        // uml: Event_Enter_GUI_Controlled_Mode / { this.tracer?.edgeTransition("edge6"); } TransitionTo(Stat_GUIControlMode)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge6");`.
            this.tracer?.edgeTransition("edge6");
            
            // Step 3: Enter/move towards transition target `Stat_GUIControlMode`.
            this.#STAT_GUICONTROLMODE_enter();
            
            // Stat_GUIControlMode.<InitialState> behavior
            // uml: / { this.tracer?.edgeTransition("edge58"); } TransitionTo(State_GuiModeWaitCommands)
            {
                // Step 1: Exit states until we reach `Stat_GUIControlMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge58");`.
                this.tracer?.edgeTransition("edge58");
                
                // Step 3: Enter/move towards transition target `State_GuiModeWaitCommands`.
                this.#STATE_GUIMODEWAITCOMMANDS_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for Stat_GUIControlMode.<InitialState>
        } // end of behavior for State_AutomaticMode
        
        // No ancestor handles this event.
    }
    
    #STATE_AUTOMATICMODE_event_hwwatchdog()
    {
        // State_AutomaticMode behavior
        // uml: Event_HWWatchdog / { this.tracer?.edgeTransition("edge4"); } TransitionTo(Sate_HWWatchdog)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge4");`.
            this.tracer?.edgeTransition("edge4");
            
            // Step 3: Enter/move towards transition target `Sate_HWWatchdog`.
            this.#SATE_HWWATCHDOG_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_AutomaticMode
        
        // No ancestor handles this event.
    }
    
    #STATE_AUTOMATICMODE_event_safetyfail()
    {
        // State_AutomaticMode behavior
        // uml: Event_SafetyFail / { this.tracer?.edgeTransition("edge5"); } TransitionTo(Sate_SafetyFail)
        {
            // Step 1: Exit states until we reach `ROOT` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.ROOT);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge5");`.
            this.tracer?.edgeTransition("edge5");
            
            // Step 3: Enter/move towards transition target `Sate_SafetyFail`.
            this.#SATE_SAFETYFAIL_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_AutomaticMode
        
        // No ancestor handles this event.
    }
    
    #State_AutomaticMode_ChoicePoint__transition()
    {
        // State_AutomaticMode.<ChoicePoint>() behavior
        // uml: [this.tracer?.log(" User evaluating guard: " + "CarbonationEnabled()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>()","[CarbonationEnabled()] TransitionTo(State_Carbonating)")] / { this.tracer?.edgeTransition("edge24"); } TransitionTo(State_Carbonating)
        if (this.tracer?.log(" User evaluating guard: " + "CarbonationEnabled()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>()","[CarbonationEnabled()] TransitionTo(State_Carbonating)"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge24");`.
            this.tracer?.edgeTransition("edge24");
            
            // Step 3: Enter/move towards transition target `State_Carbonating`.
            this.#STATE_CARBONATING_enter();
            
            // State_Carbonating.<InitialState> behavior
            // uml: / { this.tracer?.edgeTransition("edge12"); } TransitionTo(Sate_Start_Carbonating)
            {
                // Step 1: Exit states until we reach `State_Carbonating` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge12");`.
                this.tracer?.edgeTransition("edge12");
                
                // Step 3: Enter/move towards transition target `Sate_Start_Carbonating`.
                this.#SATE_START_CARBONATING_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for State_Carbonating.<InitialState>
        } // end of behavior for State_AutomaticMode.<ChoicePoint>()
        
        // State_AutomaticMode.<ChoicePoint>() behavior
        // uml: else / { this.tracer?.edgeTransition("edge23"); } TransitionTo(State_ExitFilteringOnly)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge23");`.
            this.tracer?.edgeTransition("edge23");
            
            // Step 3: Enter/move towards transition target `State_ExitFilteringOnly`.
            this.#STATE_EXITFILTERINGONLY_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_AutomaticMode.<ChoicePoint>()
    }
    
    #State_AutomaticMode_ChoicePoint_OOTBorNormal__transition()
    {
        // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) behavior
        // uml: [this.tracer?.log(" User evaluating guard: " + "IsOOTBState()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>(OOTBorNormal)","[IsOOTBState()] TransitionTo(State_OOTBSetup)")] / { this.tracer?.edgeTransition("edge52"); } TransitionTo(State_OOTBSetup)
        if (this.tracer?.log(" User evaluating guard: " + "IsOOTBState()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>(OOTBorNormal)","[IsOOTBState()] TransitionTo(State_OOTBSetup)"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge52");`.
            this.tracer?.edgeTransition("edge52");
            
            // Step 3: Enter/move towards transition target `State_OOTBSetup`.
            this.#STATE_OOTBSETUP_enter();
            
            // State_OOTBSetup.<InitialState> behavior
            // uml: / { this.tracer?.edgeTransition("edge43"); } TransitionTo(State_Startup)
            {
                // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge43");`.
                this.tracer?.edgeTransition("edge43");
                
                // Step 3: Enter/move towards transition target `State_Startup`.
                this.#STATE_STARTUP_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for State_OOTBSetup.<InitialState>
        } // end of behavior for State_AutomaticMode.<ChoicePoint>(OOTBorNormal)
        
        // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) behavior
        // uml: else / { this.tracer?.edgeTransition("edge53"); } TransitionTo(State_Awake)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge53");`.
            this.tracer?.edgeTransition("edge53");
            
            // Step 3: Enter/move towards transition target `State_Awake`.
            this.#STATE_AWAKE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_AutomaticMode.<ChoicePoint>(OOTBorNormal)
    }
    
    #State_AutomaticMode_InitialState_transition()
    {
        // State_AutomaticMode.<InitialState> behavior
        // uml: / { this.tracer?.edgeTransition("edge54"); } TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge54");`.
            this.tracer?.edgeTransition("edge54");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>(OOTBorNormal)`.
            // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_ChoicePoint_OOTBorNormal__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_AutomaticMode.<InitialState>
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_EXIT_CARBONATING
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_EXIT_CARBONATING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_EXIT_CARBONATING;
        
        // Sate_Exit_Carbonating behavior
        // uml: enter / { this.tracer?.enterState('Sate_Exit_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_Exit_Carbonating');`
            this.tracer?.enterState('Sate_Exit_Carbonating');
        } // end of behavior for Sate_Exit_Carbonating
        
        // Sate_Exit_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopCarbonation();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");`
            this.tracer?.log(" FSM would execute action: " + "StopCarbonation();");
        } // end of behavior for Sate_Exit_Carbonating
        
        // Sate_Exit_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);");
        } // end of behavior for Sate_Exit_Carbonating
    }
    
    #SATE_EXIT_CARBONATING_exit()
    {
        // Sate_Exit_Carbonating behavior
        // uml: exit / { this.tracer?.exitState('Sate_Exit_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_Exit_Carbonating');`
            this.tracer?.exitState('Sate_Exit_Carbonating');
        } // end of behavior for Sate_Exit_Carbonating
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #SATE_EXIT_CARBONATING_do()
    {
        let consume_event = false;
        
        // Sate_Exit_Carbonating behavior
        // uml: do / { this.tracer?.edgeTransition("edge17"); } TransitionTo(State_MakeDrinkDone)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#SATE_EXIT_CARBONATING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge17");`.
            this.tracer?.edgeTransition("edge17");
            
            // Step 3: Enter/move towards transition target `State_MakeDrinkDone`.
            this.#STATE_MAKEDRINKDONE_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Sate_Exit_Carbonating
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_AWAKE
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_AWAKE_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_AWAKE;
        
        // State_Awake behavior
        // uml: enter / { this.tracer?.enterState('State_Awake'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Awake');`
            this.tracer?.enterState('State_Awake');
        } // end of behavior for State_Awake
    }
    
    #STATE_AWAKE_exit()
    {
        // State_Awake behavior
        // uml: exit / { this.tracer?.exitState('State_Awake'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Awake');`
            this.tracer?.exitState('State_Awake');
        } // end of behavior for State_Awake
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_AWAKE_event_carblevelshortpressed()
    {
        // State_Awake behavior
        // uml: Event_CarbLevelShortPressed / { this.tracer?.edgeTransition("edge27"); } TransitionTo(State_SetLevel)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge27");`.
            this.tracer?.edgeTransition("edge27");
            
            // Step 3: Enter/move towards transition target `State_SetLevel`.
            this.#STATE_SETLEVEL_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Awake
        
        // No ancestor handles this event.
    }
    
    #STATE_AWAKE_event_filterbuttonlongpressed()
    {
        // State_Awake behavior
        // uml: Event_FilterButtonLongPressed / { this.tracer?.edgeTransition("edge28"); } TransitionTo(State_Rinsing)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge28");`.
            this.tracer?.edgeTransition("edge28");
            
            // Step 3: Enter/move towards transition target `State_Rinsing`.
            this.#STATE_RINSING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Awake
        
        // No ancestor handles this event.
    }
    
    #STATE_AWAKE_event_primarybuttonpressed()
    {
        // State_Awake behavior
        // uml: Event_PrimaryButtonPressed / { this.tracer?.edgeTransition("edge29"); } TransitionTo(State_AutomaticMode.<ChoicePoint>())
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge29");`.
            this.tracer?.edgeTransition("edge29");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>()`.
            // State_AutomaticMode.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // State_AutomaticMode.<ChoicePoint>() behavior
            // uml: [this.tracer?.log(" User evaluating guard: " + "IsBottleFull()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>()","[IsBottleFull()] TransitionTo(State_AutomaticMode.<ChoicePoint>())")] / { this.tracer?.edgeTransition("edge21"); } TransitionTo(State_AutomaticMode.<ChoicePoint>())
            if (this.tracer?.log(" User evaluating guard: " + "IsBottleFull()") || this.evaluateGuard("State_AutomaticMode.<ChoicePoint>()","[IsBottleFull()] TransitionTo(State_AutomaticMode.<ChoicePoint>())"))
            {
                // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge21");`.
                this.tracer?.edgeTransition("edge21");
                
                // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>()`.
                // State_AutomaticMode.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
                
                // Finish transition by calling pseudo state transition function.
                this.#State_AutomaticMode_ChoicePoint__transition();
                return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
            } // end of behavior for State_AutomaticMode.<ChoicePoint>()
            
            // State_AutomaticMode.<ChoicePoint>() behavior
            // uml: else / { this.tracer?.edgeTransition("edge22"); } TransitionTo(State_Filtering)
            {
                // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge22");`.
                this.tracer?.edgeTransition("edge22");
                
                // Step 3: Enter/move towards transition target `State_Filtering`.
                this.#STATE_FILTERING_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for State_AutomaticMode.<ChoicePoint>()
        } // end of behavior for State_Awake
        
        // No ancestor handles this event.
    }
    
    #State_Awake_ChoicePoint__transition()
    {
        // State_Awake.<ChoicePoint>() behavior
        // uml: [this.tracer?.log(" User evaluating guard: " + "IsFirstPowerON() || FilterLifeTimeExpired()") || this.evaluateGuard("State_Awake.<ChoicePoint>()","[IsFirstPowerON() || FilterLifeTimeExpired()] TransitionTo(State_ReadyRinseRequired)")] / { this.tracer?.edgeTransition("edge31"); } TransitionTo(State_ReadyRinseRequired)
        if (this.tracer?.log(" User evaluating guard: " + "IsFirstPowerON() || FilterLifeTimeExpired()") || this.evaluateGuard("State_Awake.<ChoicePoint>()","[IsFirstPowerON() || FilterLifeTimeExpired()] TransitionTo(State_ReadyRinseRequired)"))
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge31");`.
            this.tracer?.edgeTransition("edge31");
            
            // Step 3: Enter/move towards transition target `State_ReadyRinseRequired`.
            this.#STATE_READYRINSEREQUIRED_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Awake.<ChoicePoint>()
        
        // State_Awake.<ChoicePoint>() behavior
        // uml: else / { this.tracer?.edgeTransition("edge30"); } TransitionTo(State_Ready)
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge30");`.
            this.tracer?.edgeTransition("edge30");
            
            // Step 3: Enter/move towards transition target `State_Ready`.
            this.#STATE_READY_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Awake.<ChoicePoint>()
    }
    
    #State_Awake_InitialState_transition()
    {
        // State_Awake.<InitialState> behavior
        // uml: / { this.tracer?.edgeTransition("edge36"); } TransitionTo(State_Splash)
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge36");`.
            this.tracer?.edgeTransition("edge36");
            
            // Step 3: Enter/move towards transition target `State_Splash`.
            this.#STATE_SPLASH_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Awake.<InitialState>
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_READY
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_READY_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_READY;
        
        // State_Ready behavior
        // uml: enter / { this.tracer?.enterState('State_Ready'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Ready');`
            this.tracer?.enterState('State_Ready');
        } // end of behavior for State_Ready
        
        // State_Ready behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();");
        } // end of behavior for State_Ready
    }
    
    #STATE_READY_exit()
    {
        // State_Ready behavior
        // uml: exit / { this.tracer?.exitState('State_Ready'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Ready');`
            this.tracer?.exitState('State_Ready');
        } // end of behavior for State_Ready
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AWAKE;
    }
    
    #STATE_READY_do()
    {
        let consume_event = false;
        
        // State_Ready behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "ReadyTimerExpired()") || this.evaluateGuard("State_Ready","do [ReadyTimerExpired()] TransitionTo(State_Sleeping)")] / { this.tracer?.edgeTransition("edge33"); } TransitionTo(State_Sleeping)
        if (this.tracer?.log(" User evaluating guard: " + "ReadyTimerExpired()") || this.evaluateGuard("State_Ready","do [ReadyTimerExpired()] TransitionTo(State_Sleeping)"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge33");`.
            this.tracer?.edgeTransition("edge33");
            
            // Step 3: Enter/move towards transition target `State_Sleeping`.
            this.#STATE_SLEEPING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Ready
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    #STATE_READY_event_filterbuttonshortpressed()
    {
        // State_Ready behavior
        // uml: Event_FilterButtonShortPressed / { this.tracer?.edgeTransition("edge32"); } TransitionTo(State_Awake.<ChoicePoint>())
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition).
            this.#STATE_READY_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge32");`.
            this.tracer?.edgeTransition("edge32");
            
            // Step 3: Enter/move towards transition target `State_Awake.<ChoicePoint>()`.
            // State_Awake.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_ChoicePoint__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Ready
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_READYRINSEREQUIRED
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_READYRINSEREQUIRED_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_READYRINSEREQUIRED;
        
        // State_ReadyRinseRequired behavior
        // uml: enter / { this.tracer?.enterState('State_ReadyRinseRequired'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_ReadyRinseRequired');`
            this.tracer?.enterState('State_ReadyRinseRequired');
        } // end of behavior for State_ReadyRinseRequired
        
        // State_ReadyRinseRequired behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FilterState);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FilterState);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FilterState);");
        } // end of behavior for State_ReadyRinseRequired
        
        // State_ReadyRinseRequired behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartReadyTimer();");
        } // end of behavior for State_ReadyRinseRequired
    }
    
    #STATE_READYRINSEREQUIRED_exit()
    {
        // State_ReadyRinseRequired behavior
        // uml: exit / { this.tracer?.exitState('State_ReadyRinseRequired'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_ReadyRinseRequired');`
            this.tracer?.exitState('State_ReadyRinseRequired');
        } // end of behavior for State_ReadyRinseRequired
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AWAKE;
    }
    
    #STATE_READYRINSEREQUIRED_do()
    {
        let consume_event = false;
        
        // State_ReadyRinseRequired behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "ReadyTimerExpired()") || this.evaluateGuard("State_ReadyRinseRequired","do [ReadyTimerExpired()] TransitionTo(State_Sleeping)")] / { this.tracer?.edgeTransition("edge35"); } TransitionTo(State_Sleeping)
        if (this.tracer?.log(" User evaluating guard: " + "ReadyTimerExpired()") || this.evaluateGuard("State_ReadyRinseRequired","do [ReadyTimerExpired()] TransitionTo(State_Sleeping)"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge35");`.
            this.tracer?.edgeTransition("edge35");
            
            // Step 3: Enter/move towards transition target `State_Sleeping`.
            this.#STATE_SLEEPING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_ReadyRinseRequired
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    #STATE_READYRINSEREQUIRED_event_filterbuttonshortpressed()
    {
        // State_ReadyRinseRequired behavior
        // uml: Event_FilterButtonShortPressed / { this.tracer?.edgeTransition("edge34"); } TransitionTo(State_Awake.<ChoicePoint>())
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition).
            this.#STATE_READYRINSEREQUIRED_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge34");`.
            this.tracer?.edgeTransition("edge34");
            
            // Step 3: Enter/move towards transition target `State_Awake.<ChoicePoint>()`.
            // State_Awake.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_ChoicePoint__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_ReadyRinseRequired
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_SPLASH
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_SPLASH_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_SPLASH;
        
        // State_Splash behavior
        // uml: enter / { this.tracer?.enterState('State_Splash'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Splash');`
            this.tracer?.enterState('State_Splash');
        } // end of behavior for State_Splash
        
        // State_Splash behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);");
        } // end of behavior for State_Splash
        
        // State_Splash behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);");
        } // end of behavior for State_Splash
    }
    
    #STATE_SPLASH_exit()
    {
        // State_Splash behavior
        // uml: exit / { this.tracer?.exitState('State_Splash'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Splash');`
            this.tracer?.exitState('State_Splash');
        } // end of behavior for State_Splash
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AWAKE;
    }
    
    #STATE_SPLASH_do()
    {
        let consume_event = false;
        
        // State_Splash behavior
        // uml: do / { this.tracer?.edgeTransition("edge37"); } TransitionTo(State_Awake.<ChoicePoint>())
        {
            // Step 1: Exit states until we reach `State_Awake` state (Least Common Ancestor for transition).
            this.#STATE_SPLASH_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge37");`.
            this.tracer?.edgeTransition("edge37");
            
            // Step 3: Enter/move towards transition target `State_Awake.<ChoicePoint>()`.
            // State_Awake.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_ChoicePoint__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Splash
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_CARBONATING
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_CARBONATING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_CARBONATING;
        
        // State_Carbonating behavior
        // uml: enter / { this.tracer?.enterState('State_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Carbonating');`
            this.tracer?.enterState('State_Carbonating');
        } // end of behavior for State_Carbonating
    }
    
    #STATE_CARBONATING_exit()
    {
        // State_Carbonating behavior
        // uml: exit / { this.tracer?.exitState('State_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Carbonating');`
            this.tracer?.exitState('State_Carbonating');
        } // end of behavior for State_Carbonating
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_CARBONATING_event_anykeypress()
    {
        // State_Carbonating behavior
        // uml: Event_AnyKeyPress / { this.tracer?.edgeTransition("edge10"); } TransitionTo(Sate_Exit_Carbonating)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge10");`.
            this.tracer?.edgeTransition("edge10");
            
            // Step 3: Enter/move towards transition target `Sate_Exit_Carbonating`.
            this.#SATE_EXIT_CARBONATING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Carbonating
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_CARBONATING_OFF
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_CARBONATING_OFF_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_CARBONATING_OFF;
        
        // Sate_Carbonating_off behavior
        // uml: enter / { this.tracer?.enterState('Sate_Carbonating_off'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_Carbonating_off');`
            this.tracer?.enterState('Sate_Carbonating_off');
        } // end of behavior for Sate_Carbonating_off
        
        // Sate_Carbonating_off behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();");
        } // end of behavior for Sate_Carbonating_off
        
        // Sate_Carbonating_off behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPump(0);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPump(0);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPump(0);");
        } // end of behavior for Sate_Carbonating_off
    }
    
    #SATE_CARBONATING_OFF_exit()
    {
        // Sate_Carbonating_off behavior
        // uml: exit / { this.tracer?.log(" FSM would execute action: " + "carbCycle++;"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "carbCycle++;");`
            this.tracer?.log(" FSM would execute action: " + "carbCycle++;");
        } // end of behavior for Sate_Carbonating_off
        
        // Sate_Carbonating_off behavior
        // uml: exit / { this.tracer?.exitState('Sate_Carbonating_off'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_Carbonating_off');`
            this.tracer?.exitState('Sate_Carbonating_off');
        } // end of behavior for Sate_Carbonating_off
        
        this.stateId = SMSodaStreamPure.StateId.STATE_CARBONATING;
    }
    
    #SATE_CARBONATING_OFF_do()
    {
        let consume_event = false;
        
        // Sate_Carbonating_off behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "CarbonationOffCycleExpired(carbCycle)") || this.evaluateGuard("Sate_Carbonating_off","do [CarbonationOffCycleExpired(carbCycle)] TransitionTo(State_Carbonating.<ChoicePoint>())")] / { this.tracer?.edgeTransition("edge14"); } TransitionTo(State_Carbonating.<ChoicePoint>())
        if (this.tracer?.log(" User evaluating guard: " + "CarbonationOffCycleExpired(carbCycle)") || this.evaluateGuard("Sate_Carbonating_off","do [CarbonationOffCycleExpired(carbCycle)] TransitionTo(State_Carbonating.<ChoicePoint>())"))
        {
            // Step 1: Exit states until we reach `State_Carbonating` state (Least Common Ancestor for transition).
            this.#SATE_CARBONATING_OFF_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge14");`.
            this.tracer?.edgeTransition("edge14");
            
            // Step 3: Enter/move towards transition target `State_Carbonating.<ChoicePoint>()`.
            // State_Carbonating.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // State_Carbonating.<ChoicePoint>() behavior
            // uml: [this.tracer?.log(" User evaluating guard: " + "IsCarbonationLastCycle(carbCycle)") || this.evaluateGuard("State_Carbonating.<ChoicePoint>()","[IsCarbonationLastCycle(carbCycle)] TransitionTo(Sate_Exit_Carbonating)")] / { this.tracer?.edgeTransition("edge16"); } TransitionTo(Sate_Exit_Carbonating)
            if (this.tracer?.log(" User evaluating guard: " + "IsCarbonationLastCycle(carbCycle)") || this.evaluateGuard("State_Carbonating.<ChoicePoint>()","[IsCarbonationLastCycle(carbCycle)] TransitionTo(Sate_Exit_Carbonating)"))
            {
                // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
                this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge16");`.
                this.tracer?.edgeTransition("edge16");
                
                // Step 3: Enter/move towards transition target `Sate_Exit_Carbonating`.
                this.#SATE_EXIT_CARBONATING_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for State_Carbonating.<ChoicePoint>()
            
            // State_Carbonating.<ChoicePoint>() behavior
            // uml: else / { this.tracer?.edgeTransition("edge15"); } TransitionTo(Sate_Carbonating_on)
            {
                // Step 1: Exit states until we reach `State_Carbonating` state (Least Common Ancestor for transition). Already at LCA, no exiting required.
                
                // Step 2: Transition action: `this.tracer?.edgeTransition("edge15");`.
                this.tracer?.edgeTransition("edge15");
                
                // Step 3: Enter/move towards transition target `Sate_Carbonating_on`.
                this.#SATE_CARBONATING_ON_enter();
                
                // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
                return;
            } // end of behavior for State_Carbonating.<ChoicePoint>()
        } // end of behavior for Sate_Carbonating_off
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_CARBONATING_ON
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_CARBONATING_ON_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_CARBONATING_ON;
        
        // Sate_Carbonating_on behavior
        // uml: enter / { this.tracer?.enterState('Sate_Carbonating_on'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_Carbonating_on');`
            this.tracer?.enterState('Sate_Carbonating_on');
        } // end of behavior for Sate_Carbonating_on
        
        // Sate_Carbonating_on behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartCarbStageTimer();");
        } // end of behavior for Sate_Carbonating_on
        
        // Sate_Carbonating_on behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPump(1);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPump(1);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPump(1);");
        } // end of behavior for Sate_Carbonating_on
    }
    
    #SATE_CARBONATING_ON_exit()
    {
        // Sate_Carbonating_on behavior
        // uml: exit / { this.tracer?.exitState('Sate_Carbonating_on'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_Carbonating_on');`
            this.tracer?.exitState('Sate_Carbonating_on');
        } // end of behavior for Sate_Carbonating_on
        
        this.stateId = SMSodaStreamPure.StateId.STATE_CARBONATING;
    }
    
    #SATE_CARBONATING_ON_do()
    {
        let consume_event = false;
        
        // Sate_Carbonating_on behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "CarbonationOnCycleExpired(carbCycle)") || this.evaluateGuard("Sate_Carbonating_on","do [CarbonationOnCycleExpired(carbCycle)] TransitionTo(Sate_Carbonating_off)")] / { this.tracer?.edgeTransition("edge13"); } TransitionTo(Sate_Carbonating_off)
        if (this.tracer?.log(" User evaluating guard: " + "CarbonationOnCycleExpired(carbCycle)") || this.evaluateGuard("Sate_Carbonating_on","do [CarbonationOnCycleExpired(carbCycle)] TransitionTo(Sate_Carbonating_off)"))
        {
            // Step 1: Exit states until we reach `State_Carbonating` state (Least Common Ancestor for transition).
            this.#SATE_CARBONATING_ON_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge13");`.
            this.tracer?.edgeTransition("edge13");
            
            // Step 3: Enter/move towards transition target `Sate_Carbonating_off`.
            this.#SATE_CARBONATING_OFF_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Sate_Carbonating_on
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state SATE_START_CARBONATING
    ////////////////////////////////////////////////////////////////////////////////
    
    #SATE_START_CARBONATING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.SATE_START_CARBONATING;
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.enterState('Sate_Start_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.enterState('Sate_Start_Carbonating');`
            this.tracer?.enterState('Sate_Start_Carbonating');
        } // end of behavior for Sate_Start_Carbonating
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");
        } // end of behavior for Sate_Start_Carbonating
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");
        } // end of behavior for Sate_Start_Carbonating
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartCarbonationLedSequance();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartCarbonationLedSequance();");`
            this.tracer?.log(" FSM would execute action: " + "StartCarbonationLedSequance();");
        } // end of behavior for Sate_Start_Carbonating
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartCarbonation();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartCarbonation();");`
            this.tracer?.log(" FSM would execute action: " + "StartCarbonation();");
        } // end of behavior for Sate_Start_Carbonating
        
        // Sate_Start_Carbonating behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "carbCycle = 0;"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "carbCycle = 0;");`
            this.tracer?.log(" FSM would execute action: " + "carbCycle = 0;");
        } // end of behavior for Sate_Start_Carbonating
    }
    
    #SATE_START_CARBONATING_exit()
    {
        // Sate_Start_Carbonating behavior
        // uml: exit / { this.tracer?.exitState('Sate_Start_Carbonating'); }
        {
            // Step 1: execute action `this.tracer?.exitState('Sate_Start_Carbonating');`
            this.tracer?.exitState('Sate_Start_Carbonating');
        } // end of behavior for Sate_Start_Carbonating
        
        this.stateId = SMSodaStreamPure.StateId.STATE_CARBONATING;
    }
    
    #SATE_START_CARBONATING_do()
    {
        let consume_event = false;
        
        // Sate_Start_Carbonating behavior
        // uml: do / { this.tracer?.edgeTransition("edge11"); } TransitionTo(Sate_Carbonating_on)
        {
            // Step 1: Exit states until we reach `State_Carbonating` state (Least Common Ancestor for transition).
            this.#SATE_START_CARBONATING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge11");`.
            this.tracer?.edgeTransition("edge11");
            
            // Step 3: Enter/move towards transition target `Sate_Carbonating_on`.
            this.#SATE_CARBONATING_ON_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for Sate_Start_Carbonating
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_EXITFILTERINGONLY
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_EXITFILTERINGONLY_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_EXITFILTERINGONLY;
        
        // State_ExitFilteringOnly behavior
        // uml: enter / { this.tracer?.enterState('State_ExitFilteringOnly'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_ExitFilteringOnly');`
            this.tracer?.enterState('State_ExitFilteringOnly');
        } // end of behavior for State_ExitFilteringOnly
        
        // State_ExitFilteringOnly behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(0);");
        } // end of behavior for State_ExitFilteringOnly
        
        // State_ExitFilteringOnly behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for State_ExitFilteringOnly
        
        // State_ExitFilteringOnly behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for State_ExitFilteringOnly
    }
    
    #STATE_EXITFILTERINGONLY_exit()
    {
        // State_ExitFilteringOnly behavior
        // uml: exit / { this.tracer?.exitState('State_ExitFilteringOnly'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_ExitFilteringOnly');`
            this.tracer?.exitState('State_ExitFilteringOnly');
        } // end of behavior for State_ExitFilteringOnly
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_EXITFILTERINGONLY_do()
    {
        let consume_event = false;
        
        // State_ExitFilteringOnly behavior
        // uml: do / { this.tracer?.edgeTransition("edge9"); } TransitionTo(State_MakeDrinkDone)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_EXITFILTERINGONLY_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge9");`.
            this.tracer?.edgeTransition("edge9");
            
            // Step 3: Enter/move towards transition target `State_MakeDrinkDone`.
            this.#STATE_MAKEDRINKDONE_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_ExitFilteringOnly
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_FILTERING
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_FILTERING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_FILTERING;
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.enterState('State_Filtering'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Filtering');`
            this.tracer?.enterState('State_Filtering');
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartMakeDring);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartMakeDring);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartMakeDring);");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartWaterFilterLedSequence();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartWaterFilterLedSequence();");`
            this.tracer?.log(" FSM would execute action: " + "StartWaterFilterLedSequence();");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartUVLEd();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartUVLEd();");`
            this.tracer?.log(" FSM would execute action: " + "StartUVLEd();");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;");`
            this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StartWaterPump();");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();");
        } // end of behavior for State_Filtering
    }
    
    #STATE_FILTERING_exit()
    {
        // State_Filtering behavior
        // uml: exit / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: exit / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: exit / { this.tracer?.exitState('State_Filtering'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Filtering');`
            this.tracer?.exitState('State_Filtering');
        } // end of behavior for State_Filtering
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_FILTERING_do()
    {
        let consume_event = false;
        
        // State_Filtering behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "WaterPumpTimerExpired()") || this.evaluateGuard("State_Filtering","do [WaterPumpTimerExpired()] TransitionTo(State_ExitFilteringOnly)")] / { this.tracer?.edgeTransition("edge18"); } TransitionTo(State_ExitFilteringOnly)
        if (this.tracer?.log(" User evaluating guard: " + "WaterPumpTimerExpired()") || this.evaluateGuard("State_Filtering","do [WaterPumpTimerExpired()] TransitionTo(State_ExitFilteringOnly)"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_FILTERING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge18");`.
            this.tracer?.edgeTransition("edge18");
            
            // Step 3: Enter/move towards transition target `State_ExitFilteringOnly`.
            this.#STATE_EXITFILTERINGONLY_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Filtering
        
        // State_Filtering behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "IsBottleFull()") || this.evaluateGuard("State_Filtering","do [IsBottleFull()] TransitionTo(State_AutomaticMode.<ChoicePoint>())")] / { this.tracer?.edgeTransition("edge20"); } TransitionTo(State_AutomaticMode.<ChoicePoint>())
        if (this.tracer?.log(" User evaluating guard: " + "IsBottleFull()") || this.evaluateGuard("State_Filtering","do [IsBottleFull()] TransitionTo(State_AutomaticMode.<ChoicePoint>())"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_FILTERING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge20");`.
            this.tracer?.edgeTransition("edge20");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>()`.
            // State_AutomaticMode.<ChoicePoint>() is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_ChoicePoint__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Filtering
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    #STATE_FILTERING_event_anykeypress()
    {
        // State_Filtering behavior
        // uml: Event_AnyKeyPress / { this.tracer?.edgeTransition("edge19"); } TransitionTo(State_ExitFilteringOnly)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_FILTERING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge19");`.
            this.tracer?.edgeTransition("edge19");
            
            // Step 3: Enter/move towards transition target `State_ExitFilteringOnly`.
            this.#STATE_EXITFILTERINGONLY_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Filtering
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_MAKEDRINKDONE
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_MAKEDRINKDONE_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_MAKEDRINKDONE;
        
        // State_MakeDrinkDone behavior
        // uml: enter / { this.tracer?.enterState('State_MakeDrinkDone'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_MakeDrinkDone');`
            this.tracer?.enterState('State_MakeDrinkDone');
        } // end of behavior for State_MakeDrinkDone
        
        // State_MakeDrinkDone behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DoneMakeDring);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DoneMakeDring);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DoneMakeDring);");
        } // end of behavior for State_MakeDrinkDone
    }
    
    #STATE_MAKEDRINKDONE_exit()
    {
        // State_MakeDrinkDone behavior
        // uml: exit / { this.tracer?.exitState('State_MakeDrinkDone'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_MakeDrinkDone');`
            this.tracer?.exitState('State_MakeDrinkDone');
        } // end of behavior for State_MakeDrinkDone
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_MAKEDRINKDONE_do()
    {
        let consume_event = false;
        
        // State_MakeDrinkDone behavior
        // uml: do / { this.tracer?.edgeTransition("edge25"); } TransitionTo(State_Awake)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_MAKEDRINKDONE_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge25");`.
            this.tracer?.edgeTransition("edge25");
            
            // Step 3: Enter/move towards transition target `State_Awake`.
            this.#STATE_AWAKE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_MakeDrinkDone
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBSETUP
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBSETUP_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
        
        // State_OOTBSetup behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBSetup'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBSetup');`
            this.tracer?.enterState('State_OOTBSetup');
        } // end of behavior for State_OOTBSetup
    }
    
    #STATE_OOTBSETUP_exit()
    {
        // State_OOTBSetup behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBSetup'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBSetup');`
            this.tracer?.exitState('State_OOTBSetup');
        } // end of behavior for State_OOTBSetup
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBCLEARCO2WARN
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBCLEARCO2WARN_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBCLEARCO2WARN;
        
        // State_OOTBClearCO2Warn behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBClearCO2Warn'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBClearCO2Warn');`
            this.tracer?.enterState('State_OOTBClearCO2Warn');
        } // end of behavior for State_OOTBClearCO2Warn
        
        // State_OOTBClearCO2Warn behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ClearCO2OOTBFlag();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ClearCO2OOTBFlag();");`
            this.tracer?.log(" FSM would execute action: " + "ClearCO2OOTBFlag();");
        } // end of behavior for State_OOTBClearCO2Warn
        
        // State_OOTBClearCO2Warn behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartUpCO2);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartUpCO2);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_StartUpCO2);");
        } // end of behavior for State_OOTBClearCO2Warn
    }
    
    #STATE_OOTBCLEARCO2WARN_exit()
    {
        // State_OOTBClearCO2Warn behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBClearCO2Warn'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBClearCO2Warn');`
            this.tracer?.exitState('State_OOTBClearCO2Warn');
        } // end of behavior for State_OOTBClearCO2Warn
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBCLEARCO2WARN_do()
    {
        let consume_event = false;
        
        // State_OOTBClearCO2Warn behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBClearCO2Warn","do [!IsLedsSequencePlaying()] TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))")] / { this.tracer?.edgeTransition("edge51"); } TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))
        if (this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBClearCO2Warn","do [!IsLedsSequencePlaying()] TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge51");`.
            this.tracer?.edgeTransition("edge51");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>(OOTBorNormal)`.
            // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_ChoicePoint_OOTBorNormal__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_OOTBClearCO2Warn
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBCO2DOWN
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBCO2DOWN_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBCO2DOWN;
        
        // State_OOTBCO2Down behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBCO2Down'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBCO2Down');`
            this.tracer?.enterState('State_OOTBCO2Down');
        } // end of behavior for State_OOTBCO2Down
        
        // State_OOTBCO2Down behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBCO2Down);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBCO2Down);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBCO2Down);");
        } // end of behavior for State_OOTBCO2Down
    }
    
    #STATE_OOTBCO2DOWN_exit()
    {
        // State_OOTBCO2Down behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBCO2Down'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBCO2Down');`
            this.tracer?.exitState('State_OOTBCO2Down');
        } // end of behavior for State_OOTBCO2Down
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBCO2DOWN_event_carblevellongpressed()
    {
        // State_OOTBCO2Down behavior
        // uml: Event_CarbLevelLongPressed / { this.tracer?.edgeTransition("edge40"); } TransitionTo(State_OOTBClearCO2Warn)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBCO2DOWN_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge40");`.
            this.tracer?.edgeTransition("edge40");
            
            // Step 3: Enter/move towards transition target `State_OOTBClearCO2Warn`.
            this.#STATE_OOTBCLEARCO2WARN_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBCO2Down
        
        // No ancestor handles this event.
    }
    
    #STATE_OOTBCO2DOWN_event_carblevelshortpressed()
    {
        // State_OOTBCO2Down behavior
        // uml: Event_CarbLevelShortPressed / { this.tracer?.edgeTransition("edge39"); } TransitionTo(State_OOTBSetLevel)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBCO2DOWN_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge39");`.
            this.tracer?.edgeTransition("edge39");
            
            // Step 3: Enter/move towards transition target `State_OOTBSetLevel`.
            this.#STATE_OOTBSETLEVEL_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBCO2Down
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBDISPLAYSTATUS
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBDISPLAYSTATUS_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBDISPLAYSTATUS;
        
        // State_OOTBDisplayStatus behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBDisplayStatus'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBDisplayStatus');`
            this.tracer?.enterState('State_OOTBDisplayStatus');
        } // end of behavior for State_OOTBDisplayStatus
        
        // State_OOTBDisplayStatus behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DisplayStatus);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DisplayStatus);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_DisplayStatus);");
        } // end of behavior for State_OOTBDisplayStatus
        
        // State_OOTBDisplayStatus behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(true);");
        } // end of behavior for State_OOTBDisplayStatus
    }
    
    #STATE_OOTBDISPLAYSTATUS_exit()
    {
        // State_OOTBDisplayStatus behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBDisplayStatus'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBDisplayStatus');`
            this.tracer?.exitState('State_OOTBDisplayStatus');
        } // end of behavior for State_OOTBDisplayStatus
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBDISPLAYSTATUS_event_carbleveldown()
    {
        // State_OOTBDisplayStatus behavior
        // uml: Event_CarbLevelDown / { this.tracer?.edgeTransition("edge41"); } TransitionTo(State_OOTBCO2Down)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBDISPLAYSTATUS_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge41");`.
            this.tracer?.edgeTransition("edge41");
            
            // Step 3: Enter/move towards transition target `State_OOTBCO2Down`.
            this.#STATE_OOTBCO2DOWN_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBDisplayStatus
        
        // No ancestor handles this event.
    }
    
    #STATE_OOTBDISPLAYSTATUS_event_filterdown()
    {
        // State_OOTBDisplayStatus behavior
        // uml: Event_FilterDown / { this.tracer?.edgeTransition("edge42"); } TransitionTo(State_OOTBFilterDown)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBDISPLAYSTATUS_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge42");`.
            this.tracer?.edgeTransition("edge42");
            
            // Step 3: Enter/move towards transition target `State_OOTBFilterDown`.
            this.#STATE_OOTBFILTERDOWN_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBDisplayStatus
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBFILTERDOWN
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBFILTERDOWN_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBFILTERDOWN;
        
        // State_OOTBFilterDown behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBFilterDown'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBFilterDown');`
            this.tracer?.enterState('State_OOTBFilterDown');
        } // end of behavior for State_OOTBFilterDown
        
        // State_OOTBFilterDown behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBFilterDown);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBFilterDown);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_OOTBFilterDown);");
        } // end of behavior for State_OOTBFilterDown
    }
    
    #STATE_OOTBFILTERDOWN_exit()
    {
        // State_OOTBFilterDown behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBFilterDown'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBFilterDown');`
            this.tracer?.exitState('State_OOTBFilterDown');
        } // end of behavior for State_OOTBFilterDown
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBFILTERDOWN_event_filterbuttonlongpressed()
    {
        // State_OOTBFilterDown behavior
        // uml: Event_FilterButtonLongPressed / { this.tracer?.edgeTransition("edge49"); } TransitionTo(State_Rinsing)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#exitUpToStateHandler(SMSodaStreamPure.StateId.STATE_AUTOMATICMODE);
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge49");`.
            this.tracer?.edgeTransition("edge49");
            
            // Step 3: Enter/move towards transition target `State_Rinsing`.
            this.#STATE_RINSING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBFilterDown
        
        // No ancestor handles this event.
    }
    
    #STATE_OOTBFILTERDOWN_event_filterbuttonshortpressed()
    {
        // State_OOTBFilterDown behavior
        // uml: Event_FilterButtonShortPressed / { this.tracer?.edgeTransition("edge48"); } TransitionTo(State_OOTBFilterWarning)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBFILTERDOWN_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge48");`.
            this.tracer?.edgeTransition("edge48");
            
            // Step 3: Enter/move towards transition target `State_OOTBFilterWarning`.
            this.#STATE_OOTBFILTERWARNING_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBFilterDown
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBFILTERWARNING
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBFILTERWARNING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBFILTERWARNING;
        
        // State_OOTBFilterWarning behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBFilterWarning'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBFilterWarning');`
            this.tracer?.enterState('State_OOTBFilterWarning');
        } // end of behavior for State_OOTBFilterWarning
        
        // State_OOTBFilterWarning behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FIlterWarning);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FIlterWarning);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_FIlterWarning);");
        } // end of behavior for State_OOTBFilterWarning
    }
    
    #STATE_OOTBFILTERWARNING_exit()
    {
        // State_OOTBFilterWarning behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBFilterWarning'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBFilterWarning');`
            this.tracer?.exitState('State_OOTBFilterWarning');
        } // end of behavior for State_OOTBFilterWarning
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBFILTERWARNING_do()
    {
        let consume_event = false;
        
        // State_OOTBFilterWarning behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBFilterWarning","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)")] / { this.tracer?.edgeTransition("edge47"); } TransitionTo(State_OOTBDisplayStatus)
        if (this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBFilterWarning","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)"))
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBFILTERWARNING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge47");`.
            this.tracer?.edgeTransition("edge47");
            
            // Step 3: Enter/move towards transition target `State_OOTBDisplayStatus`.
            this.#STATE_OOTBDISPLAYSTATUS_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBFilterWarning
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_OOTBSETLEVEL
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_OOTBSETLEVEL_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETLEVEL;
        
        // State_OOTBSetLevel behavior
        // uml: enter / { this.tracer?.enterState('State_OOTBSetLevel'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_OOTBSetLevel');`
            this.tracer?.enterState('State_OOTBSetLevel');
        } // end of behavior for State_OOTBSetLevel
        
        // State_OOTBSetLevel behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_CO2Warning);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_CO2Warning);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_CO2Warning);");
        } // end of behavior for State_OOTBSetLevel
    }
    
    #STATE_OOTBSETLEVEL_exit()
    {
        // State_OOTBSetLevel behavior
        // uml: exit / { this.tracer?.exitState('State_OOTBSetLevel'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_OOTBSetLevel');`
            this.tracer?.exitState('State_OOTBSetLevel');
        } // end of behavior for State_OOTBSetLevel
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_OOTBSETLEVEL_do()
    {
        let consume_event = false;
        
        // State_OOTBSetLevel behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBSetLevel","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)")] / { this.tracer?.edgeTransition("edge50"); } TransitionTo(State_OOTBDisplayStatus)
        if (this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_OOTBSetLevel","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)"))
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_OOTBSETLEVEL_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge50");`.
            this.tracer?.edgeTransition("edge50");
            
            // Step 3: Enter/move towards transition target `State_OOTBDisplayStatus`.
            this.#STATE_OOTBDISPLAYSTATUS_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_OOTBSetLevel
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_SPASHINTERRUPTED
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_SPASHINTERRUPTED_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_SPASHINTERRUPTED;
        
        // State_SpashInterrupted behavior
        // uml: enter / { this.tracer?.enterState('State_SpashInterrupted'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_SpashInterrupted');`
            this.tracer?.enterState('State_SpashInterrupted');
        } // end of behavior for State_SpashInterrupted
        
        // State_SpashInterrupted behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_allOff);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_allOff);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_allOff);");
        } // end of behavior for State_SpashInterrupted
    }
    
    #STATE_SPASHINTERRUPTED_exit()
    {
        // State_SpashInterrupted behavior
        // uml: exit / { this.tracer?.exitState('State_SpashInterrupted'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_SpashInterrupted');`
            this.tracer?.exitState('State_SpashInterrupted');
        } // end of behavior for State_SpashInterrupted
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_SPASHINTERRUPTED_do()
    {
        let consume_event = false;
        
        // State_SpashInterrupted behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_SpashInterrupted","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)")] / { this.tracer?.edgeTransition("edge46"); } TransitionTo(State_OOTBDisplayStatus)
        if (this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_SpashInterrupted","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)"))
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_SPASHINTERRUPTED_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge46");`.
            this.tracer?.edgeTransition("edge46");
            
            // Step 3: Enter/move towards transition target `State_OOTBDisplayStatus`.
            this.#STATE_OOTBDISPLAYSTATUS_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_SpashInterrupted
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_STARTUP
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_STARTUP_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_STARTUP;
        
        // State_Startup behavior
        // uml: enter / { this.tracer?.enterState('State_Startup'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Startup');`
            this.tracer?.enterState('State_Startup');
        } // end of behavior for State_Startup
        
        // State_Startup behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Splash);");
        } // end of behavior for State_Startup
        
        // State_Startup behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");
        } // end of behavior for State_Startup
    }
    
    #STATE_STARTUP_exit()
    {
        // State_Startup behavior
        // uml: exit / { this.tracer?.exitState('State_Startup'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Startup');`
            this.tracer?.exitState('State_Startup');
        } // end of behavior for State_Startup
        
        this.stateId = SMSodaStreamPure.StateId.STATE_OOTBSETUP;
    }
    
    #STATE_STARTUP_do()
    {
        let consume_event = false;
        
        // State_Startup behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_Startup","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)")] / { this.tracer?.edgeTransition("edge44"); } TransitionTo(State_OOTBDisplayStatus)
        if (this.tracer?.log(" User evaluating guard: " + "!IsLedsSequencePlaying()") || this.evaluateGuard("State_Startup","do [!IsLedsSequencePlaying()] TransitionTo(State_OOTBDisplayStatus)"))
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_STARTUP_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge44");`.
            this.tracer?.edgeTransition("edge44");
            
            // Step 3: Enter/move towards transition target `State_OOTBDisplayStatus`.
            this.#STATE_OOTBDISPLAYSTATUS_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Startup
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    #STATE_STARTUP_event_anykeypress()
    {
        // State_Startup behavior
        // uml: Event_AnyKeyPress / { this.tracer?.edgeTransition("edge45"); } TransitionTo(State_SpashInterrupted)
        {
            // Step 1: Exit states until we reach `State_OOTBSetup` state (Least Common Ancestor for transition).
            this.#STATE_STARTUP_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge45");`.
            this.tracer?.edgeTransition("edge45");
            
            // Step 3: Enter/move towards transition target `State_SpashInterrupted`.
            this.#STATE_SPASHINTERRUPTED_enter();
            
            // Step 4: complete transition. Ends event dispatch. No other behaviors are checked.
            return;
        } // end of behavior for State_Startup
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_RINSING
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_RINSING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_RINSING;
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.enterState('State_Rinsing'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Rinsing');`
            this.tracer?.enterState('State_Rinsing');
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Rinsing);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Rinsing);");`
            this.tracer?.log(" FSM would execute action: " + "LedsSequence(LEDS_Rinsing);");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;");`
            this.tracer?.log(" FSM would execute action: " + "pumpStopsOnSensor = true;");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");`
            this.tracer?.log(" FSM would execute action: " + "SolenoidPumpUVPower(1);");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StartWaterPump();");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ResetFilterLifetimeTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ResetFilterLifetimeTimer();");`
            this.tracer?.log(" FSM would execute action: " + "ResetFilterLifetimeTimer();");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();");`
            this.tracer?.log(" FSM would execute action: " + "StartWaterPumpingTimer();");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "StartUVLEd();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StartUVLEd();");`
            this.tracer?.log(" FSM would execute action: " + "StartUVLEd();");
        } // end of behavior for State_Rinsing
    }
    
    #STATE_RINSING_exit()
    {
        // State_Rinsing behavior
        // uml: exit / { this.tracer?.log(" FSM would execute action: " + "StopWaterPump();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");`
            this.tracer?.log(" FSM would execute action: " + "StopWaterPump();");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: exit / { this.tracer?.log(" FSM would execute action: " + "StopUVLed();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "StopUVLed();");`
            this.tracer?.log(" FSM would execute action: " + "StopUVLed();");
        } // end of behavior for State_Rinsing
        
        // State_Rinsing behavior
        // uml: exit / { this.tracer?.exitState('State_Rinsing'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Rinsing');`
            this.tracer?.exitState('State_Rinsing');
        } // end of behavior for State_Rinsing
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_RINSING_do()
    {
        let consume_event = false;
        
        // State_Rinsing behavior
        // uml: do [this.tracer?.log(" User evaluating guard: " + "IsBottleFull()||WaterPumpTimerExpired()") || this.evaluateGuard("State_Rinsing","do [IsBottleFull()||WaterPumpTimerExpired()] TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))")] / { this.tracer?.edgeTransition("edge7"); } TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))
        if (this.tracer?.log(" User evaluating guard: " + "IsBottleFull()||WaterPumpTimerExpired()") || this.evaluateGuard("State_Rinsing","do [IsBottleFull()||WaterPumpTimerExpired()] TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))"))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_RINSING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge7");`.
            this.tracer?.edgeTransition("edge7");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>(OOTBorNormal)`.
            // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_ChoicePoint_OOTBorNormal__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Rinsing
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    #STATE_RINSING_event_anykeypress()
    {
        // State_Rinsing behavior
        // uml: Event_AnyKeyPress / { this.tracer?.edgeTransition("edge8"); } TransitionTo(State_AutomaticMode.<ChoicePoint>(OOTBorNormal))
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_RINSING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge8");`.
            this.tracer?.edgeTransition("edge8");
            
            // Step 3: Enter/move towards transition target `State_AutomaticMode.<ChoicePoint>(OOTBorNormal)`.
            // State_AutomaticMode.<ChoicePoint>(OOTBorNormal) is a pseudo state and cannot have an `enter` trigger.
            
            // Finish transition by calling pseudo state transition function.
            this.#State_AutomaticMode_ChoicePoint_OOTBorNormal__transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Rinsing
        
        // No ancestor handles this event.
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_SETLEVEL
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_SETLEVEL_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_SETLEVEL;
        
        // State_SetLevel behavior
        // uml: enter / { this.tracer?.enterState('State_SetLevel'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_SetLevel');`
            this.tracer?.enterState('State_SetLevel');
        } // end of behavior for State_SetLevel
        
        // State_SetLevel behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "SetLevelLeds();"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "SetLevelLeds();");`
            this.tracer?.log(" FSM would execute action: " + "SetLevelLeds();");
        } // end of behavior for State_SetLevel
    }
    
    #STATE_SETLEVEL_exit()
    {
        // State_SetLevel behavior
        // uml: exit / { this.tracer?.exitState('State_SetLevel'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_SetLevel');`
            this.tracer?.exitState('State_SetLevel');
        } // end of behavior for State_SetLevel
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_SETLEVEL_do()
    {
        let consume_event = false;
        
        // State_SetLevel behavior
        // uml: do / { this.tracer?.edgeTransition("edge26"); } TransitionTo(State_Awake)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_SETLEVEL_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge26");`.
            this.tracer?.edgeTransition("edge26");
            
            // Step 3: Enter/move towards transition target `State_Awake`.
            this.#STATE_AWAKE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_SetLevel
        
        // Check if event has been consumed before calling ancestor handler.
        if (!consume_event)
        {
            this.#STATE_AUTOMATICMODE_do();
        }
    }
    
    
    ////////////////////////////////////////////////////////////////////////////////
    // event handlers for state STATE_SLEEPING
    ////////////////////////////////////////////////////////////////////////////////
    
    #STATE_SLEEPING_enter()
    {
        this.stateId = SMSodaStreamPure.StateId.STATE_SLEEPING;
        
        // State_Sleeping behavior
        // uml: enter / { this.tracer?.enterState('State_Sleeping'); }
        {
            // Step 1: execute action `this.tracer?.enterState('State_Sleeping');`
            this.tracer?.enterState('State_Sleeping');
        } // end of behavior for State_Sleeping
        
        // State_Sleeping behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");`
            this.tracer?.log(" FSM would execute action: " + "ButtonsFunction(false);");
        } // end of behavior for State_Sleeping
        
        // State_Sleeping behavior
        // uml: enter / { this.tracer?.log(" FSM would execute action: " + "FadeOutLeds(LEDS_all);"); }
        {
            // Step 1: execute action `this.tracer?.log(" FSM would execute action: " + "FadeOutLeds(LEDS_all);");`
            this.tracer?.log(" FSM would execute action: " + "FadeOutLeds(LEDS_all);");
        } // end of behavior for State_Sleeping
    }
    
    #STATE_SLEEPING_exit()
    {
        // State_Sleeping behavior
        // uml: exit / { this.tracer?.exitState('State_Sleeping'); }
        {
            // Step 1: execute action `this.tracer?.exitState('State_Sleeping');`
            this.tracer?.exitState('State_Sleeping');
        } // end of behavior for State_Sleeping
        
        this.stateId = SMSodaStreamPure.StateId.STATE_AUTOMATICMODE;
    }
    
    #STATE_SLEEPING_event_anykeypress()
    {
        // State_Sleeping behavior
        // uml: Event_AnyKeyPress / { this.tracer?.edgeTransition("edge38"); } TransitionTo(State_Awake)
        {
            // Step 1: Exit states until we reach `State_AutomaticMode` state (Least Common Ancestor for transition).
            this.#STATE_SLEEPING_exit();
            
            // Step 2: Transition action: `this.tracer?.edgeTransition("edge38");`.
            this.tracer?.edgeTransition("edge38");
            
            // Step 3: Enter/move towards transition target `State_Awake`.
            this.#STATE_AWAKE_enter();
            
            // Finish transition by calling pseudo state transition function.
            this.#State_Awake_InitialState_transition();
            return; // event processing immediately stops when a transition finishes. No other behaviors for this state are checked.
        } // end of behavior for State_Sleeping
        
        // No ancestor handles this event.
    }
    
    // Thread safe.
    static stateIdToString(id)
    {
        switch (id)
        {
            case SMSodaStreamPure.StateId.ROOT: return "ROOT";
            case SMSodaStreamPure.StateId.SATE_HWWATCHDOG: return "SATE_HWWATCHDOG";
            case SMSodaStreamPure.StateId.SATE_SAFETYFAIL: return "SATE_SAFETYFAIL";
            case SMSodaStreamPure.StateId.SATE_TILTED: return "SATE_TILTED";
            case SMSodaStreamPure.StateId.STAT_GUICONTROLMODE: return "STAT_GUICONTROLMODE";
            case SMSodaStreamPure.StateId.STATE_GUIMODEWAITCOMMANDS: return "STATE_GUIMODEWAITCOMMANDS";
            case SMSodaStreamPure.StateId.STATE_STOPWATERPUMP: return "STATE_STOPWATERPUMP";
            case SMSodaStreamPure.StateId.STATE_AUTOMATICMODE: return "STATE_AUTOMATICMODE";
            case SMSodaStreamPure.StateId.SATE_EXIT_CARBONATING: return "SATE_EXIT_CARBONATING";
            case SMSodaStreamPure.StateId.STATE_AWAKE: return "STATE_AWAKE";
            case SMSodaStreamPure.StateId.STATE_READY: return "STATE_READY";
            case SMSodaStreamPure.StateId.STATE_READYRINSEREQUIRED: return "STATE_READYRINSEREQUIRED";
            case SMSodaStreamPure.StateId.STATE_SPLASH: return "STATE_SPLASH";
            case SMSodaStreamPure.StateId.STATE_CARBONATING: return "STATE_CARBONATING";
            case SMSodaStreamPure.StateId.SATE_CARBONATING_OFF: return "SATE_CARBONATING_OFF";
            case SMSodaStreamPure.StateId.SATE_CARBONATING_ON: return "SATE_CARBONATING_ON";
            case SMSodaStreamPure.StateId.SATE_START_CARBONATING: return "SATE_START_CARBONATING";
            case SMSodaStreamPure.StateId.STATE_EXITFILTERINGONLY: return "STATE_EXITFILTERINGONLY";
            case SMSodaStreamPure.StateId.STATE_FILTERING: return "STATE_FILTERING";
            case SMSodaStreamPure.StateId.STATE_MAKEDRINKDONE: return "STATE_MAKEDRINKDONE";
            case SMSodaStreamPure.StateId.STATE_OOTBSETUP: return "STATE_OOTBSETUP";
            case SMSodaStreamPure.StateId.STATE_OOTBCLEARCO2WARN: return "STATE_OOTBCLEARCO2WARN";
            case SMSodaStreamPure.StateId.STATE_OOTBCO2DOWN: return "STATE_OOTBCO2DOWN";
            case SMSodaStreamPure.StateId.STATE_OOTBDISPLAYSTATUS: return "STATE_OOTBDISPLAYSTATUS";
            case SMSodaStreamPure.StateId.STATE_OOTBFILTERDOWN: return "STATE_OOTBFILTERDOWN";
            case SMSodaStreamPure.StateId.STATE_OOTBFILTERWARNING: return "STATE_OOTBFILTERWARNING";
            case SMSodaStreamPure.StateId.STATE_OOTBSETLEVEL: return "STATE_OOTBSETLEVEL";
            case SMSodaStreamPure.StateId.STATE_SPASHINTERRUPTED: return "STATE_SPASHINTERRUPTED";
            case SMSodaStreamPure.StateId.STATE_STARTUP: return "STATE_STARTUP";
            case SMSodaStreamPure.StateId.STATE_RINSING: return "STATE_RINSING";
            case SMSodaStreamPure.StateId.STATE_SETLEVEL: return "STATE_SETLEVEL";
            case SMSodaStreamPure.StateId.STATE_SLEEPING: return "STATE_SLEEPING";
            default: return "?";
        }
    }
    
    // Thread safe.
    static eventIdToString(id)
    {
        switch (id)
        {
            case SMSodaStreamPure.EventId.DO: return "DO";
            case SMSodaStreamPure.EventId.EVENT_ANYKEYPRESS: return "EVENT_ANYKEYPRESS";
            case SMSodaStreamPure.EventId.EVENT_BOTTLEFULLSENSOR: return "EVENT_BOTTLEFULLSENSOR";
            case SMSodaStreamPure.EventId.EVENT_CARBLEVELDOWN: return "EVENT_CARBLEVELDOWN";
            case SMSodaStreamPure.EventId.EVENT_CARBLEVELLONGPRESSED: return "EVENT_CARBLEVELLONGPRESSED";
            case SMSodaStreamPure.EventId.EVENT_CARBLEVELSHORTPRESSED: return "EVENT_CARBLEVELSHORTPRESSED";
            case SMSodaStreamPure.EventId.EVENT_ENTER_GUI_CONTROLLED_MODE: return "EVENT_ENTER_GUI_CONTROLLED_MODE";
            case SMSodaStreamPure.EventId.EVENT_EXIT_GUI_CONTROLLED_MODE: return "EVENT_EXIT_GUI_CONTROLLED_MODE";
            case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONLONGPRESSED: return "EVENT_FILTERBUTTONLONGPRESSED";
            case SMSodaStreamPure.EventId.EVENT_FILTERBUTTONSHORTPRESSED: return "EVENT_FILTERBUTTONSHORTPRESSED";
            case SMSodaStreamPure.EventId.EVENT_FILTERDOWN: return "EVENT_FILTERDOWN";
            case SMSodaStreamPure.EventId.EVENT_HWWATCHDOG: return "EVENT_HWWATCHDOG";
            case SMSodaStreamPure.EventId.EVENT_PRIMARYBUTTONPRESSED: return "EVENT_PRIMARYBUTTONPRESSED";
            case SMSodaStreamPure.EventId.EVENT_SAFETYFAIL: return "EVENT_SAFETYFAIL";
            default: return "?";
        }
    }
}

</script>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        import svgPanZoom from 'https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/+esm' ;
        mermaid.initialize({ startOnLoad: false });
        await mermaid.run();

        // svg-pan-zoom doesn't like the mermaid viewbox
        document.querySelector('svg').removeAttribute('viewBox');
        document.querySelector('svg').setAttribute('width', '100%');
        document.querySelector('svg').setAttribute('height', '100%');
        document.querySelector('svg').style["max-width"] = '';

        // don't scale the arrow when we scale the transition edge
        document.querySelectorAll('g defs marker[id$=barbEnd]').forEach(marker => {
            marker.setAttribute('markerUnits', 'userSpaceOnUse');
        });

        // https://github.com/StateSmith/StateSmith/issues/404
        // https://github.com/StateSmith/StateSmith/issues/294
        // rewrite $initial_state to a black circle
        document.querySelectorAll('g[data-id*="(InitialState)"]').forEach(g=> {
          g.innerHTML = '<circle transform="translate(0,3)" height="14" width="14" r="14" class="state - start"></circle>';
        })

        var panZoom = window.panZoom = svgPanZoom(document.querySelector('svg'), {
            zoomEnabled: true,
            controlIconsEnabled: true,
            fit: true,
            center: true
        });

        const diagramEventNamesArray = ['do', 'Event_AnyKeyPress', 'Event_BottleFullSensor', 'Event_CarbLevelDown', 'Event_CarbLevelLongPressed', 'Event_CarbLevelShortPressed', 'Event_Enter_GUI_Controlled_Mode', 'Event_Exit_GUI_Controlled_Mode', 'Event_FilterButtonLongPressed', 'Event_FilterButtonShortPressed', 'Event_FilterDown', 'Event_HWWatchdog', 'Event_PrimaryButtonPressed', 'Event_SafetyFail', ];

        // Mapping from state to available events
        const stateEventsMapping = {
  "Sate_Tilted": [
    "do",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_AutomaticMode": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_Rinsing": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_ExitFilteringOnly": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_Carbonating": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "Sate_Start_Carbonating": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "Sate_Carbonating_on": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "Sate_Carbonating_off": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "Sate_Exit_Carbonating": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_Filtering": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_MakeDrinkDone": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_SetLevel": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_Awake": [
    "do",
    "Event_CarbLevelShortPressed",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterButtonLongPressed",
    "Event_HWWatchdog",
    "Event_PrimaryButtonPressed",
    "Event_SafetyFail"
  ],
  "State_Ready": [
    "do",
    "Event_CarbLevelShortPressed",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterButtonLongPressed",
    "Event_FilterButtonShortPressed",
    "Event_HWWatchdog",
    "Event_PrimaryButtonPressed",
    "Event_SafetyFail"
  ],
  "State_ReadyRinseRequired": [
    "do",
    "Event_CarbLevelShortPressed",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterButtonLongPressed",
    "Event_FilterButtonShortPressed",
    "Event_HWWatchdog",
    "Event_PrimaryButtonPressed",
    "Event_SafetyFail"
  ],
  "State_Splash": [
    "do",
    "Event_CarbLevelShortPressed",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterButtonLongPressed",
    "Event_HWWatchdog",
    "Event_PrimaryButtonPressed",
    "Event_SafetyFail"
  ],
  "State_Sleeping": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBSetup": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBCO2Down": [
    "do",
    "Event_CarbLevelLongPressed",
    "Event_CarbLevelShortPressed",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBDisplayStatus": [
    "do",
    "Event_CarbLevelDown",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterDown",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_Startup": [
    "do",
    "Event_AnyKeyPress",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_SpashInterrupted": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBFilterWarning": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBFilterDown": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_FilterButtonLongPressed",
    "Event_FilterButtonShortPressed",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBSetLevel": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "State_OOTBClearCO2Warn": [
    "do",
    "Event_Enter_GUI_Controlled_Mode",
    "Event_HWWatchdog",
    "Event_SafetyFail"
  ],
  "Sate_SafetyFail": [],
  "Sate_HWWatchdog": [],
  "Stat_GUIControlMode": [
    "Event_Exit_GUI_Controlled_Mode",
    "Event_HWWatchdog"
  ],
  "State_GuiModeWaitCommands": [
    "Event_BottleFullSensor",
    "Event_Exit_GUI_Controlled_Mode",
    "Event_HWWatchdog"
  ],
  "State_StopWaterPump": [
    "do",
    "Event_Exit_GUI_Controlled_Mode",
    "Event_HWWatchdog"
  ]
};

        // Get page element references
        const leftPane = document.querySelector(".main");
        const rightPane = document.querySelector(".sidebar");
        const gutter = document.querySelector(".gutter");

        // Function to resize panes
        function resizer(e) {          
          window.addEventListener('mousemove', mousemove);
          window.addEventListener('mouseup', mouseup);          
          let prevX = e.x;
          const rightPanel = rightPane.getBoundingClientRect();
                    
          function mousemove(e) {
            let newX = prevX - e.x;
            rightPane.style.width = rightPanel.width + newX + 'px';
            window.panZoom.resize();
            window.panZoom.fit();
            window.panZoom.center();
          }
          
          function mouseup() {
            window.removeEventListener('mousemove', mousemove);
            window.removeEventListener('mouseup', mouseup);
          }                  
        }

        // Add mouse down event listener for the resizer
        gutter.addEventListener('mousedown', resizer);



        //------------------- drop down functionality start -------------------
        const dropdownButton = document.getElementById('dropdown-button');
        const dropdownDiv = document.getElementById('myDropdown');

        dropdownButton.addEventListener('click', toggleDropdown);

        /* When the user clicks on the button, 
        toggle between hiding and showing the dropdown content */
        function toggleDropdown(event) {
          dropdownDiv.classList.toggle('show');
          event.stopPropagation(); // Prevent click from causing the window click handler to close the dropdown
        }

        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
          const isClickedOutsideDropdownDiv = !dropdownDiv.contains(event.target);

          if (isClickedOutsideDropdownDiv) {
            dropdownDiv.classList.remove('show');
          }
        }

        // Close the dropdown if the user presses Escape
        document.addEventListener('keydown', function(event) {
          if (event.key === 'Escape') {
            dropdownDiv.classList.remove('show');
          }
        });

        // Set the state of the timestamp checkbox
        document.getElementById('timestamps').checked = document.querySelector('table.console').classList.contains('timestamps');
        document.getElementById('timestamps').addEventListener('change', function() {
          if(this.checked) {
            document.querySelector('table.console').classList.add('timestamps');
          } else {
            document.querySelector('table.console').classList.remove('timestamps');
          }
        });

        // Set up hide irrelevant events checkbox state and event listener
        document.getElementById('hideIrrelevantEvents').addEventListener('change', function() {
          // When checkbox state changes, only update button visibility, not availability
          updateButtonVisibility();
        });

        //------------------- drop down functionality end -------------------



        // Convert a date to a string in the format HH:MM:SS.sss
        function formatTime(date) {
            return date.getHours().toString().padStart(2, '0') + ':' +
                date.getMinutes().toString().padStart(2, '0') + ':' +
                date.getSeconds().toString().padStart(2, '0') + '.' +
                date.getMilliseconds().toString().padStart(3, '0');
        }

        // Add a row to the history table.
        function addHistoryRow(time, event, html = false) {
            var row = document.createElement('tr');
            var timeCell = document.createElement('td');
            timeCell.innerText = formatTime(time);
            timeCell.classList.add('timestamp');
            var eventCell = document.createElement('td');

            if(html) {
              eventCell.innerHTML = event;
            } else {
              eventCell.innerText = event;
            }

            row.appendChild(timeCell);
            row.appendChild(eventCell);
            document.querySelector('tbody').appendChild(row);
        }

        var sm = new SMSodaStreamPure();

        // prompt the user to evaluate guards manually
        sm.evaluateGuard = (vertexName, behaviorUml) => {
            return confirm(`Evaluate guard for\n${vertexName} behavior:\n${behaviorUml}.\n\nPress 'OK' to evaluate guard as true and 'Cancel' to evaluate it as false.`);
        }; 

        const highlightedEdges = new Set();
        function highlightEdge(edgeId) {
            var edge = document.getElementById(edgeId);
            if (edge) {
              edge.classList.add('active');
              highlightedEdges.add(edge);
            }
        }

        function clearHighlightedEdges() {
            for (const edge of highlightedEdges) {
              edge.classList.remove('active');
              const showOldTraversal = false;
              if (showOldTraversal) {
                  // shows that the edge was traversed. Optional, but kinda nice.
                  edge.style.stroke = 'green';
              }
            }
            highlightedEdges.clear();
        }

        // Function to update event button states (availability and visibility)
        function updateEventButtonStates(currentStateName) {
            const availableEvents = stateEventsMapping[currentStateName] || [];
            
            diagramEventNamesArray.forEach(eventName => {
                const button = document.getElementById('button_' + eventName);
                if (button) {
                    const isAvailable = availableEvents.includes(eventName);
                    
                    // Only set disabled property, CSS :disabled pseudo-class handles styling
                    button.disabled = !isAvailable;
                }
            });
            
            // Update visibility based on checkbox state
            updateButtonVisibility();
        }

        // Function to update button visibility based on Hide Unused checkbox
        function updateButtonVisibility() {
            const hideIrrelevantEvents = document.getElementById('hideIrrelevantEvents').checked;
            
            diagramEventNamesArray.forEach(eventName => {
                const button = document.getElementById('button_' + eventName);
                if (button) {
                    // Toggle hidden class based on checkbox state and button disabled state
                    button.classList.toggle('hidden', hideIrrelevantEvents && button.disabled);
                }
            });
        }

        // The simulator uses a tracer callback to perform operations such as 
        // state highlighting and logging. You do not need this functionality
        // when using SMSodaStreamPure.js in your own applications, although you may
        // choose to implement a tracer for debugging purposes.
        sm.tracer = {
            enterState: (mermaidName) => {
                var e = document.querySelector('g[data-id=' + mermaidName + ']');
                if(e) {
                  e.classList.add('active');
                  panOnScreen(e);
                }
                sm.tracer.log(' Entered ' + mermaidName);
                
                // Update event button states
                updateEventButtonStates(mermaidName);
            },
            exitState: (mermaidName) => {
                document.querySelector('g[data-id=' + mermaidName + ']')?.classList.remove('active');
            },
            edgeTransition: (edgeId) => {
                highlightEdge(edgeId);
            },
            log: (message, html=false) => {
                addHistoryRow(new Date(), message, html);
            }
        };

        // Wire up the buttons that dispatch events for the state machine.
        diagramEventNamesArray.forEach(diagramEventName => {
            var button = document.createElement('button');
            button.id = 'button_' + diagramEventName;
            button.className = 'event-button';
            button.innerText = diagramEventName;
            button.addEventListener('click', () => {
                // Only handle click events when button is enabled
                if (!button.disabled) {
                    clearHighlightedEdges();
                    sm.tracer?.log('<span class="dispatched"><span class="trigger">' + diagramEventName + '</span> DISPATCHED</span>', true);
                    const fsmEventName = diagramEventName.toUpperCase();
                    sm.dispatchEvent(SMSodaStreamPure.EventId[fsmEventName]); 
                }
            });
            document.getElementById('buttons').appendChild(button);
        });

        sm.tracer?.log('<span class="dispatched">START</span>', true);
        sm.start(); // This will cause `updateEventButtonStates()` to be called.

        function panOnScreen(element) {
          if(!element) return;

          var bounds = element.getBoundingClientRect();
          if(bounds.x<0 || bounds.y<0) {
              var x = Math.max(0, -bounds.x + 20);
              var y = Math.max(0, -bounds.y + 20);
              window.panZoom.panBy({x: x, y: y});
          }
          var panebounds = document.querySelector('svg').getBoundingClientRect();
          if(bounds.x>panebounds.width || bounds.y>panebounds.height) {
              var x = Math.min(0, panebounds.width - bounds.x - bounds.width - 20);
              var y = Math.min(0, panebounds.height - bounds.y - bounds.height - 20);
              window.panZoom.panBy({x: x, y: y});
          }
        }
    </script>


  </body>
</html>
